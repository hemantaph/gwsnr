<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>gwsnr-checkpoint &mdash; gwsnr 0.2.0 documentation</title>
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../_static/graphviz.css" type="text/css" />
      <link rel="stylesheet" href="../_static/copybutton.css" type="text/css" />
      <link rel="stylesheet" href="../_static/tabs.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../_static/jquery.js?v=5d32c60e"></script>
        <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="../_static/documentation_options.js?v=938c9ccc"></script>
        <script src="../_static/doctools.js?v=888ff710"></script>
        <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
        <script src="../_static/clipboard.min.js?v=a7894cd8"></script>
        <script src="../_static/copybutton.js?v=f281be69"></script>
        <script src="../_static/tabs.js?v=3030b3cb"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            gwsnr
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <!-- Local TOC -->
              <div class="local-toc"></div>
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">gwsnr</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="index.html">Module code</a></li>
      <li class="breadcrumb-item active">gwsnr-checkpoint</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for gwsnr-checkpoint</h1><div class="highlight"><pre>
<span></span><span class="c1"># for delta_f =1/duration, duration = 16s</span>
<span class="c1"># f_min =20Hz</span>
<span class="c1"># duration=16.0, sampling_frequency=4096,</span>
<span class="c1"># note: setting mtot_min and mtot_max is important.</span>
<span class="c1"># mtot_min=219. is accordance to minimum_frequency = 20</span>
<span class="c1"># __init__ paramters are important don&#39;t to change for a particular analysis</span>
<span class="c1"># they are detector and waveform dependent parameters</span>
<span class="c1"># at f_min==10Hz: mtot_max=439.6</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">bilby</span>
<span class="kn">import</span> <span class="nn">pycbc</span>
<span class="kn">import</span> <span class="nn">pycbc.psd</span>
<span class="c1"># from pycbc.detector import Detector</span>
<span class="kn">from</span> <span class="nn">scipy.stats</span> <span class="kn">import</span> <span class="n">norm</span>
<span class="kn">from</span> <span class="nn">scipy.interpolate</span> <span class="kn">import</span> <span class="n">interp1d</span>
<span class="kn">from</span> <span class="nn">gwpy.timeseries</span> <span class="kn">import</span> <span class="n">TimeSeries</span>
<span class="kn">from</span> <span class="nn">scipy.optimize</span> <span class="kn">import</span> <span class="n">fsolve</span>
<span class="kn">from</span> <span class="nn">multiprocessing</span> <span class="kn">import</span> <span class="n">Pool</span>
<span class="kn">from</span> <span class="nn">tqdm</span> <span class="kn">import</span> <span class="n">tqdm</span>
<span class="kn">import</span> <span class="nn">json</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">pickle</span>

<span class="n">C</span> <span class="o">=</span> <span class="mf">299792458.0</span>
<span class="n">G</span> <span class="o">=</span> <span class="mf">6.67408</span> <span class="o">*</span> <span class="mf">1e-11</span>
<span class="n">Mo</span> <span class="o">=</span> <span class="mf">1.989</span> <span class="o">*</span> <span class="mf">1e30</span>
<span class="n">Gamma</span> <span class="o">=</span> <span class="mf">0.5772156649015329</span>
<span class="n">Pi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span>
<div class="viewcode-block" id="MTSUN_SI">
<a class="viewcode-back" href="../autoapi/gwsnrcheckpoint/index.html#gwsnr-checkpoint.MTSUN_SI">[docs]</a>
<span class="n">MTSUN_SI</span> <span class="o">=</span> <span class="mf">4.925491025543576e-06</span></div>


<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">------------------------------------------------</span>
<span class="sd">    class containing following methods</span>
<span class="sd">    1. to calculate fast SNR</span>
<span class="sd">    2. interpolation of with cubic spline</span>
<span class="sd">    with bilby SNR</span>
<span class="sd">    3. Pdet: probability of detection</span>
<span class="sd">------------------------------------------------</span>
<span class="sd">&quot;&quot;&quot;</span>


<span class="k">class</span> <span class="nc">GWSNR</span><span class="p">:</span>
    <span class="c1">####################################################</span>
    <span class="c1">#                                                  #</span>
    <span class="c1">#             Class initialization                 #</span>
    <span class="c1">#                                                  #</span>
    <span class="c1">####################################################</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">npool</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span>
        <span class="n">mtot_min</span><span class="o">=</span><span class="mf">2.0</span><span class="p">,</span>
        <span class="n">mtot_max</span><span class="o">=</span><span class="mf">439.6</span><span class="p">,</span>
        <span class="n">nsamples_mtot</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span>
        <span class="n">nsamples_mass_ratio</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span>
        <span class="n">sampling_frequency</span><span class="o">=</span><span class="mf">2048.0</span><span class="p">,</span>
        <span class="n">waveform_approximant</span><span class="o">=</span><span class="s2">&quot;IMRPhenomD&quot;</span><span class="p">,</span>
        <span class="n">minimum_frequency</span><span class="o">=</span><span class="mf">20.0</span><span class="p">,</span>
        <span class="n">snr_type</span><span class="o">=</span><span class="s2">&quot;interpolation&quot;</span><span class="p">,</span>
        <span class="n">waveform_inspiral_must_be_above_fmin</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">psds</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">psd_file</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">ifos</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">interpolator_dir</span><span class="o">=</span><span class="s2">&quot;./interpolator_pickle&quot;</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initialized parameters and functions</span>
<span class="sd">        snr_half_scaled() : function for finding (f/PSD) integration in the limit [f_min,f_max]</span>
<span class="sd">        list_of_detectors :  list of detector initials, e.g. L1 for Livingston</span>
<span class="sd">        f_min : minimum frequency for the detector</span>
<span class="sd">        -----------------</span>
<span class="sd">        input parameters</span>
<span class="sd">        -----------------</span>
<span class="sd">        mtot_min           : minimum value of Mtotal=mass_1+mass_2, use in interpolation</span>
<span class="sd">        mtot_max           : maximum value of Mtotal=mass_1+mass_2, use in interpolation</span>
<span class="sd">        nsamples           : number of points you want to use for SNR interpolation (here it is half SNR not complete)</span>
<span class="sd">        list_of_detectors  : detector list. It can be single or multiple.</span>
<span class="sd">        duration           : duration of the data in time domain. </span>
<span class="sd">        sampling_frequency : sampling frequency of the data. e.g. 4096Hz,2048Hz,1024Hz</span>
<span class="sd">        waveform_arguments : contains which waveform model to use for interpolation. Extra paramters like reference_frequency\</span>
<span class="sd">                             minimum_frequency are also included. minimum_frequency will also relate to the mtot_max set inside\</span>
<span class="sd">                             the code. High mass blackholes tends to merge at lower frequency &lt; f_min, and can have SNR=0</span>
<span class="sd">        snr_type           : method for SNR calculation. Values: &#39;interpolation&#39;, &#39;inner_product&#39; </span>
<span class="sd">        </span>
<span class="sd">        psds               : psd dict.</span>
<span class="sd">                               example_1=&gt; when values are psd name from pycbc analytical psds, </span>
<span class="sd">                               psds={&#39;L1&#39;:&#39;aLIGOaLIGODesignSensitivityT1800044&#39;,&#39;H1&#39;:&#39;aLIGOaLIGODesignSensitivityT1800044&#39;,&#39;V1&#39;:&#39;AdvVirgo&#39;}</span>
<span class="sd">                               to check available psd name run $ import pycbc.psd ; $ pycbc.psd.get_lalsim_psd_list()</span>
<span class="sd">                               example_2=&gt; when values are psd txt file in bilby,</span>
<span class="sd">                               psds={&#39;L1&#39;:&#39;aLIGO_O4_high_asd.txt&#39;,&#39;H1&#39;:&#39;aLIGO_O4_high_asd.txt&#39;, &#39;V1&#39;:&#39;AdV_asd.txt&#39;, &#39;K1&#39;:&#39;KAGRA_design_asd.txt&#39;}</span>
<span class="sd">                               For other psd files, check https://github.com/lscsoft/bilby/tree/master/bilby/gw/detector/noise_curves</span>
<span class="sd">                               example_3=&gt; when values are custom psd txt file.</span>
<span class="sd">                               psds={&#39;L1&#39;:&#39;custom_psd.txt&#39;,&#39;H1&#39;:&#39;custom_psd.txt&#39;}</span>
<span class="sd">                               custom created txt file has two columns. 1st column: frequency array, 2nd column: strain </span>
<span class="sd">        psd_file           : if set True, the given value of psds param should be of psds instead of asd. If asd, set psd_file=False.</span>
<span class="sd">        </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">npool</span> <span class="o">=</span> <span class="n">npool</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mtot_min</span> <span class="o">=</span> <span class="n">mtot_min</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mtot_max</span> <span class="o">=</span> <span class="n">mtot_max</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nsamples</span> <span class="o">=</span> <span class="n">nsamples_mtot</span>
        <span class="n">ratio</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">geomspace</span><span class="p">(</span><span class="mf">0.1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">nsamples_mass_ratio</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ratio</span> <span class="o">=</span> <span class="n">ratio</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">sampling_frequency</span> <span class="o">=</span> <span class="n">sampling_frequency</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">waveform_approximant</span> <span class="o">=</span> <span class="n">waveform_approximant</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">f_min</span> <span class="o">=</span> <span class="n">minimum_frequency</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">waveform_type</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">waveform_classifier</span><span class="p">(</span><span class="n">waveform_approximant</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">snr_type</span> <span class="o">=</span> <span class="n">snr_type</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">waveform_inspiral_must_be_above_fmin</span> <span class="o">=</span> <span class="n">waveform_inspiral_must_be_above_fmin</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">psds</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;psds not given. Choosing bilby&#39;s default psds&quot;</span><span class="p">)</span>
            <span class="n">psds</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
            <span class="n">psds</span><span class="p">[</span><span class="s2">&quot;L1&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;aLIGO_O4_high_asd.txt&quot;</span>
            <span class="n">psds</span><span class="p">[</span><span class="s2">&quot;H1&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;aLIGO_O4_high_asd.txt&quot;</span>
            <span class="n">psds</span><span class="p">[</span><span class="s2">&quot;V1&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;AdV_asd.txt&quot;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">psds</span> <span class="o">=</span> <span class="n">psds</span>
            <span class="n">list_of_detectors</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">psds</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
            <span class="n">psd_file</span> <span class="o">=</span> <span class="p">[</span><span class="kc">False</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">False</span><span class="p">]</span>
            <span class="c1"># for Fp, Fc calculation</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ifos</span> <span class="o">=</span> <span class="n">bilby</span><span class="o">.</span><span class="n">gw</span><span class="o">.</span><span class="n">detector</span><span class="o">.</span><span class="n">InterferometerList</span><span class="p">(</span><span class="n">list_of_detectors</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">psds</span> <span class="o">=</span> <span class="n">psds</span>
            <span class="n">list_of_detectors</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">psds</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
            <span class="n">psd_file</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">psd_file</span><span class="p">])</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">list_of_detectors</span><span class="p">))</span>
            <span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;bool&quot;</span><span class="p">)</span>
            <span class="c1"># for Fp, Fc calculation</span>
            <span class="n">ifos_</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">len_</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">list_of_detectors</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">len_</span><span class="p">):</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">ifos</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span>
                        <span class="n">ifos_</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ifos</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">ifos_</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                            <span class="n">bilby</span><span class="o">.</span><span class="n">gw</span><span class="o">.</span><span class="n">detector</span><span class="o">.</span><span class="n">InterferometerList</span><span class="p">(</span>
                                <span class="p">[</span><span class="n">list_of_detectors</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span>
                            <span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                        <span class="p">)</span>
                <span class="k">except</span><span class="p">:</span>
                    <span class="n">ifos_</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                        <span class="n">bilby</span><span class="o">.</span><span class="n">gw</span><span class="o">.</span><span class="n">detector</span><span class="o">.</span><span class="n">InterferometerList</span><span class="p">([</span><span class="n">list_of_detectors</span><span class="p">[</span><span class="n">i</span><span class="p">]])[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">ifos</span> <span class="o">=</span> <span class="n">ifos_</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;given psds: &quot;</span><span class="p">,</span> <span class="n">psds</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">psd_file</span> <span class="o">=</span> <span class="n">psd_file</span>

        <span class="c1"># dealing with interpolator</span>
        <span class="k">if</span> <span class="n">snr_type</span> <span class="o">==</span> <span class="s2">&quot;interpolation&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">interpolator_dict</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">list_of_detectors</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">psd_file_buffer</span> <span class="o">=</span> <span class="p">[]</span>

            <span class="c1"># getting interpolator if exists</span>
            <span class="n">k</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c1"># keep track of psd_file_buffer param</span>
            <span class="k">for</span> <span class="n">det</span> <span class="ow">in</span> <span class="n">list_of_detectors</span><span class="p">:</span>
                <span class="n">path_interpolator</span><span class="p">,</span> <span class="n">it_exist</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">interpolator_pickle_path</span><span class="p">(</span>
                    <span class="n">det</span><span class="p">,</span> <span class="n">list_of_detectors</span><span class="p">,</span> <span class="n">interpolator_dir</span>
                <span class="p">)</span>
                <span class="k">if</span> <span class="n">it_exist</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s2">&quot;Interpolator will be loaded for </span><span class="si">{</span><span class="n">det</span><span class="si">}</span><span class="s2"> detector from </span><span class="si">{</span><span class="n">path_interpolator</span><span class="si">}</span><span class="s2">&quot;</span>
                    <span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s2">&quot;Interpolator will be generated for </span><span class="si">{</span><span class="n">det</span><span class="si">}</span><span class="s2"> detector at </span><span class="si">{</span><span class="n">path_interpolator</span><span class="si">}</span><span class="s2">&quot;</span>
                    <span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">list_of_detectors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">det</span><span class="p">)</span>
                    <span class="n">psd_file_buffer</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">psd_file</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">interpolator_dict</span><span class="p">[</span><span class="n">det</span><span class="p">]</span> <span class="o">=</span> <span class="n">path_interpolator</span>

                <span class="n">k</span> <span class="o">+=</span> <span class="mi">1</span>  <span class="c1"># keep track of psd_file_buffer param</span>

            <span class="c1"># generating new interpolator</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">list_of_detectors</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">psd_file</span> <span class="o">=</span> <span class="n">psd_file_buffer</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">init_halfScaled</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">psd_file</span> <span class="o">=</span> <span class="n">psd_file</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;interpolator generated&quot;</span><span class="p">)</span>

        <span class="c1"># now the entire list_of_detectors</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">list_of_detectors</span> <span class="o">=</span> <span class="n">list_of_detectors</span>

        <span class="k">return</span> <span class="kc">None</span>

    <span class="c1">####################################################</span>
    <span class="c1">#                                                  #</span>
    <span class="c1">#      store or get interpolator pickle path       #</span>
    <span class="c1">#                                                  #</span>
    <span class="c1">####################################################</span>
    <span class="k">def</span> <span class="nf">interpolator_pickle_path</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">detector</span><span class="p">,</span> <span class="n">detector_list</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="s2">&quot;./interpolator_pickle&quot;</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Function for storing or getting interpolator pickle path</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        detector : str</span>
<span class="sd">            detector name</span>
<span class="sd">            e.g. &#39;L1&#39;</span>
<span class="sd">        detector_list : list</span>
<span class="sd">            list of detectors</span>
<span class="sd">            e.g. [&#39;L1&#39;,&#39;H1&#39;,&#39;V1&#39;]</span>
<span class="sd">        path : str</span>
<span class="sd">            path to store the pickle file</span>
<span class="sd">            default: &#39;./interpolator_pickle&#39;</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        path_interpolator : str</span>
<span class="sd">            path to the interpolator pickle file</span>
<span class="sd">            e.g. &#39;./interpolator_pickle/L1/halfSNR_dict_0.pickle&#39;</span>
<span class="sd">        it_exist: bool</span>
<span class="sd">            True if the interpolator exists</span>
<span class="sd">            False if the interpolator does not exists</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># arg no. for the detector from the detector list</span>
        <span class="n">det_arg</span> <span class="o">=</span> <span class="n">detector_list</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">detector</span><span class="p">)</span>
        <span class="n">det_path</span> <span class="o">=</span> <span class="n">path</span> <span class="o">+</span> <span class="s2">&quot;/&quot;</span> <span class="o">+</span> <span class="n">detector</span>

        <span class="c1"># check if path exists</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
            <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>

        <span class="c1"># check if detector path exists</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">det_path</span><span class="p">):</span>
            <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">det_path</span><span class="p">)</span>

        <span class="c1"># check if param_dict_list.pickle exists</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">det_path</span> <span class="o">+</span> <span class="s2">&quot;/param_dict_list.pickle&quot;</span><span class="p">):</span>
            <span class="n">dict_list</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">det_path</span> <span class="o">+</span> <span class="s2">&quot;/param_dict_list.pickle&quot;</span><span class="p">,</span> <span class="s2">&quot;wb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">handle</span><span class="p">:</span>
                <span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">dict_list</span><span class="p">,</span> <span class="n">handle</span><span class="p">,</span> <span class="n">protocol</span><span class="o">=</span><span class="n">pickle</span><span class="o">.</span><span class="n">HIGHEST_PROTOCOL</span><span class="p">)</span>

        <span class="c1"># for checking existing interpolator pickle in the det_path/param_dict_list.pickle file</span>
        <span class="n">param_dict_stored</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span>
            <span class="nb">open</span><span class="p">(</span><span class="n">det_path</span> <span class="o">+</span> <span class="s2">&quot;/param_dict_list.pickle&quot;</span><span class="p">,</span> <span class="s2">&quot;rb&quot;</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="n">param_dict_given</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;mtot_min&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">mtot_min</span><span class="p">,</span>
            <span class="s2">&quot;mtot_max&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">mtot_max</span><span class="p">,</span>
            <span class="s2">&quot;nsamples_mtot&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">nsamples</span><span class="p">,</span>
            <span class="s2">&quot;sampling_frequency&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">sampling_frequency</span><span class="p">,</span>
            <span class="s2">&quot;waveform_approximant&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">waveform_approximant</span><span class="p">,</span>
            <span class="s2">&quot;minimum_frequency&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">f_min</span><span class="p">,</span>
            <span class="s2">&quot;waveform_inspiral_must_be_above_fmin&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">waveform_inspiral_must_be_above_fmin</span><span class="p">,</span>
            <span class="s2">&quot;psds&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">psds</span><span class="p">[</span><span class="n">detector</span><span class="p">],</span>
            <span class="s2">&quot;psd_file&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">psd_file</span><span class="p">[</span><span class="n">det_arg</span><span class="p">],</span>
            <span class="s2">&quot;ifos&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ifos</span><span class="p">[</span><span class="n">det_arg</span><span class="p">]),</span>
        <span class="p">}</span>

        <span class="n">len_</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">param_dict_stored</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">param_dict_given</span> <span class="ow">in</span> <span class="n">param_dict_stored</span><span class="p">:</span>
            <span class="c1"># try and except is added so that user can regenerate a new interpolator pickle file just by</span>
            <span class="c1"># deleting the right file and reruing gwsnr with that params again</span>
            <span class="c1"># also, if the user delete the file by mistake, it will generate in the next run</span>
            <span class="n">idx</span> <span class="o">=</span> <span class="n">param_dict_stored</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">param_dict_given</span><span class="p">)</span>
            <span class="c1"># check if interpolator pickle exists</span>
            <span class="c1"># get halfSNR interpolator if exists</span>
            <span class="n">path_interpolator</span> <span class="o">=</span> <span class="n">det_path</span> <span class="o">+</span> <span class="s2">&quot;/halfSNR_dict_&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">idx</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;.pickle&quot;</span>
            <span class="c1"># there will be exception if the file is deleted by mistake</span>
            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">path_interpolator</span><span class="p">):</span>
                <span class="n">it_exist</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">it_exist</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="c1"># if related dict not found in the param_dict_list.pickle</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">it_exist</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="n">path_interpolator</span> <span class="o">=</span> <span class="n">det_path</span> <span class="o">+</span> <span class="s2">&quot;/halfSNR_dict_&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">len_</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;.pickle&quot;</span>
            <span class="c1"># print(&quot;related dict not found in the param_dict_list.pickle, new interpolator will be generated&quot;)</span>

            <span class="c1"># store the pickle dict</span>
            <span class="n">param_dict_stored</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">param_dict_given</span><span class="p">)</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">det_path</span> <span class="o">+</span> <span class="s2">&quot;/param_dict_list.pickle&quot;</span><span class="p">,</span> <span class="s2">&quot;wb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">handle</span><span class="p">:</span>
                <span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">param_dict_stored</span><span class="p">,</span> <span class="n">handle</span><span class="p">,</span> <span class="n">protocol</span><span class="o">=</span><span class="n">pickle</span><span class="o">.</span><span class="n">HIGHEST_PROTOCOL</span><span class="p">)</span>

        <span class="c1"># print(f&quot;In case if you need regeneration of interpolator of the given gwsnr param, please delete this file, {path_interpolator} \n&quot;)</span>

        <span class="k">return</span> <span class="p">(</span><span class="n">path_interpolator</span><span class="p">,</span> <span class="n">it_exist</span><span class="p">)</span>

    <span class="c1">####################################################</span>
    <span class="c1">#                                                  #</span>
    <span class="c1">#             waveform classifier                  #</span>
    <span class="c1">#                                                  #</span>
    <span class="c1">####################################################</span>
    <span class="k">def</span> <span class="nf">waveform_classifier</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">waveform_approximant</span><span class="p">):</span>
        <span class="n">waveform_dict</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;Inspiral&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;TaylorF2&quot;</span><span class="p">,</span> <span class="s2">&quot;TaylorF2Ecc&quot;</span><span class="p">],</span>
            <span class="s2">&quot;IMR&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;IMRPhenomD&quot;</span><span class="p">,</span> <span class="s2">&quot;IMRPhenomXPHM&quot;</span><span class="p">],</span>
            <span class="s2">&quot;Ringdown&quot;</span><span class="p">:</span> <span class="p">[],</span>
        <span class="p">}</span>
        <span class="k">if</span> <span class="n">waveform_approximant</span> <span class="ow">in</span> <span class="n">waveform_dict</span><span class="p">[</span><span class="s2">&quot;Inspiral&quot;</span><span class="p">]:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Given: Inspiral waveform, </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">waveform_approximant</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="s2">&quot;Inspiral&quot;</span>
        <span class="k">elif</span> <span class="n">waveform_approximant</span> <span class="ow">in</span> <span class="n">waveform_dict</span><span class="p">[</span><span class="s2">&quot;IMR&quot;</span><span class="p">]:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Given: IMR waveform, </span><span class="si">{self.waveform_approximant}</span><span class="s2">.&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="s2">&quot;IMR&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span>
                <span class="s2">&quot;waveform type not recognised. It will be considered as IMRPhenom waveform&quot;</span>
            <span class="p">)</span>

    <span class="c1">####################################################</span>
    <span class="c1">#                                                  #</span>
    <span class="c1">#             Main SNR finder function             #</span>
    <span class="c1">#                                                  #</span>
    <span class="c1">####################################################</span>
    <span class="k">def</span> <span class="nf">snr</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">mass_1</span><span class="o">=</span><span class="mf">10.0</span><span class="p">,</span>
        <span class="n">mass_2</span><span class="o">=</span><span class="mf">10.0</span><span class="p">,</span>
        <span class="n">luminosity_distance</span><span class="o">=</span><span class="mf">100.0</span><span class="p">,</span>
        <span class="n">iota</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
        <span class="n">psi</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
        <span class="n">phase</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
        <span class="n">geocent_time</span><span class="o">=</span><span class="mf">1246527224.169434</span><span class="p">,</span>
        <span class="n">ra</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
        <span class="n">dec</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
        <span class="n">a_1</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
        <span class="n">a_2</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
        <span class="n">tilt_1</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
        <span class="n">tilt_2</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
        <span class="n">phi_12</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
        <span class="n">phi_jl</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
        <span class="n">GWparam_dict</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">jsonFile</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        -----------------</span>
<span class="sd">        Input parameters (GW parameters)</span>
<span class="sd">        -----------------</span>
<span class="sd">        mass_1               : Heavier compact object of the binary, unit: Mo (solar mass)</span>
<span class="sd">                               (flaot array or just float)</span>
<span class="sd">        mass_2               : Lighter compact object of the binary, unit: Mo (solar mass)</span>
<span class="sd">                               (flaot array or just float)</span>
<span class="sd">        luminosity_distance  : Distance between detector and binary, unit: Mpc</span>
<span class="sd">        iota                 : Inclination angle of binary orbital plane wrt to the line of sight. unit: rad</span>
<span class="sd">        psi                  : Polarization angle. unit: rad</span>
<span class="sd">        phase                : Phase of GW at the the time of coalesence, unit: rad</span>
<span class="sd">        geocent_time         : GPS time of colescence of that GW, unit: sec</span>
<span class="sd">        ra                   : Right ascention of source position, unit: rad</span>
<span class="sd">        dec                  : Declination of source position, unit: rad</span>
<span class="sd">        -----------------</span>
<span class="sd">        Return values</span>
<span class="sd">        -----------------</span>
<span class="sd">        snr_dict              : dictionary containing net optimal snr and optimal snr of individual detectors</span>
<span class="sd">                               example of opt_snr_unscaled return values for len(mass_1)=3</span>
<span class="sd">                                {&#39;opt_snr_net&#39;: array([156.53268655, 243.00092419, 292.10396943]),</span>
<span class="sd">                                 &#39;L1&#39;: array([132.08275995, 205.04492349, 246.47822334]),</span>
<span class="sd">                                 &#39;H1&#39;: array([ 84.00372897, 130.40716432, 156.75845871])}</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">GWparam_dict</span> <span class="o">!=</span> <span class="kc">False</span><span class="p">:</span>
            <span class="n">mass_1</span> <span class="o">=</span> <span class="n">GWparam_dict</span><span class="p">[</span><span class="s2">&quot;mass_1&quot;</span><span class="p">]</span>
            <span class="n">mass_2</span> <span class="o">=</span> <span class="n">GWparam_dict</span><span class="p">[</span><span class="s2">&quot;mass_2&quot;</span><span class="p">]</span>
            <span class="n">luminosity_distance</span> <span class="o">=</span> <span class="n">GWparam_dict</span><span class="p">[</span><span class="s2">&quot;luminosity_distance&quot;</span><span class="p">]</span>
            <span class="n">iota</span> <span class="o">=</span> <span class="n">GWparam_dict</span><span class="p">[</span><span class="s2">&quot;iota&quot;</span><span class="p">]</span>
            <span class="n">psi</span> <span class="o">=</span> <span class="n">GWparam_dict</span><span class="p">[</span><span class="s2">&quot;psi&quot;</span><span class="p">]</span>
            <span class="n">phase</span> <span class="o">=</span> <span class="n">GWparam_dict</span><span class="p">[</span><span class="s2">&quot;phase&quot;</span><span class="p">]</span>
            <span class="n">geocent_time</span> <span class="o">=</span> <span class="n">GWparam_dict</span><span class="p">[</span><span class="s2">&quot;geocent_time&quot;</span><span class="p">]</span>
            <span class="n">ra</span> <span class="o">=</span> <span class="n">GWparam_dict</span><span class="p">[</span><span class="s2">&quot;ra&quot;</span><span class="p">]</span>
            <span class="n">dec</span> <span class="o">=</span> <span class="n">GWparam_dict</span><span class="p">[</span><span class="s2">&quot;dec&quot;</span><span class="p">]</span>
            <span class="n">a_1</span> <span class="o">=</span> <span class="n">GWparam_dict</span><span class="p">[</span><span class="s2">&quot;a_1&quot;</span><span class="p">]</span>
            <span class="n">a_2</span> <span class="o">=</span> <span class="n">GWparam_dict</span><span class="p">[</span><span class="s2">&quot;a_2&quot;</span><span class="p">]</span>
            <span class="n">tilt_1</span> <span class="o">=</span> <span class="n">GWparam_dict</span><span class="p">[</span><span class="s2">&quot;tilt_1&quot;</span><span class="p">]</span>
            <span class="n">tilt_2</span> <span class="o">=</span> <span class="n">GWparam_dict</span><span class="p">[</span><span class="s2">&quot;tilt_2&quot;</span><span class="p">]</span>
            <span class="n">phi_12</span> <span class="o">=</span> <span class="n">GWparam_dict</span><span class="p">[</span><span class="s2">&quot;phi_12&quot;</span><span class="p">]</span>
            <span class="n">phi_jl</span> <span class="o">=</span> <span class="n">GWparam_dict</span><span class="p">[</span><span class="s2">&quot;phi_jl&quot;</span><span class="p">]</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">snr_type</span> <span class="o">==</span> <span class="s2">&quot;interpolation&quot;</span><span class="p">:</span>
            <span class="n">snr_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">snr_with_interpolation</span><span class="p">(</span>
                <span class="n">mass_1</span><span class="p">,</span>
                <span class="n">mass_2</span><span class="p">,</span>
                <span class="n">luminosity_distance</span><span class="o">=</span><span class="n">luminosity_distance</span><span class="p">,</span>
                <span class="n">iota</span><span class="o">=</span><span class="n">iota</span><span class="p">,</span>
                <span class="n">psi</span><span class="o">=</span><span class="n">psi</span><span class="p">,</span>
                <span class="n">phase</span><span class="o">=</span><span class="n">phase</span><span class="p">,</span>
                <span class="n">geocent_time</span><span class="o">=</span><span class="n">geocent_time</span><span class="p">,</span>
                <span class="n">ra</span><span class="o">=</span><span class="n">ra</span><span class="p">,</span>
                <span class="n">dec</span><span class="o">=</span><span class="n">dec</span><span class="p">,</span>
                <span class="n">jsonFile</span><span class="o">=</span><span class="n">jsonFile</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">snr_type</span> <span class="o">==</span> <span class="s2">&quot;inner_product&quot;</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;solving SNR with inner product&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span>
                    <span class="s2">&quot;SNR function type not recognised, using inner_product method instead&quot;</span>
                <span class="p">)</span>
            <span class="n">snr_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">compute_bilby_snr_</span><span class="p">(</span>
                <span class="n">mass_1</span><span class="p">,</span>
                <span class="n">mass_2</span><span class="p">,</span>
                <span class="n">luminosity_distance</span><span class="o">=</span><span class="n">luminosity_distance</span><span class="p">,</span>
                <span class="n">theta_jn</span><span class="o">=</span><span class="n">iota</span><span class="p">,</span>
                <span class="n">psi</span><span class="o">=</span><span class="n">psi</span><span class="p">,</span>
                <span class="n">phase</span><span class="o">=</span><span class="n">phase</span><span class="p">,</span>
                <span class="n">geocent_time</span><span class="o">=</span><span class="n">geocent_time</span><span class="p">,</span>
                <span class="n">ra</span><span class="o">=</span><span class="n">ra</span><span class="p">,</span>
                <span class="n">dec</span><span class="o">=</span><span class="n">dec</span><span class="p">,</span>
                <span class="n">a_1</span><span class="o">=</span><span class="n">a_1</span><span class="p">,</span>
                <span class="n">a_2</span><span class="o">=</span><span class="n">a_2</span><span class="p">,</span>
                <span class="n">tilt_1</span><span class="o">=</span><span class="n">tilt_1</span><span class="p">,</span>
                <span class="n">tilt_2</span><span class="o">=</span><span class="n">tilt_2</span><span class="p">,</span>
                <span class="n">phi_12</span><span class="o">=</span><span class="n">phi_12</span><span class="p">,</span>
                <span class="n">phi_jl</span><span class="o">=</span><span class="n">phi_jl</span><span class="p">,</span>
                <span class="n">jsonFile</span><span class="o">=</span><span class="n">jsonFile</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">return</span> <span class="n">snr_dict</span>

    <span class="c1">####################################################</span>
    <span class="c1">#                                                  #</span>
    <span class="c1">#   fast snr with cubic spline interpolation       #</span>
    <span class="c1">#                                                  #</span>
    <span class="c1">####################################################</span>
    <span class="k">def</span> <span class="nf">snr_with_interpolation</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">mass_1</span><span class="p">,</span>
        <span class="n">mass_2</span><span class="p">,</span>
        <span class="n">luminosity_distance</span><span class="o">=</span><span class="mf">100.0</span><span class="p">,</span>
        <span class="n">iota</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
        <span class="n">psi</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
        <span class="n">phase</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
        <span class="n">geocent_time</span><span class="o">=</span><span class="mf">1246527224.169434</span><span class="p">,</span>
        <span class="n">ra</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
        <span class="n">dec</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
        <span class="n">jsonFile</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        -----------------</span>
<span class="sd">        Input parameters (GW parameters)</span>
<span class="sd">        -----------------</span>
<span class="sd">        mass_1               : Heavier compact object of the binary, unit: Mo (solar mass)</span>
<span class="sd">                               (flaot array or just float)</span>
<span class="sd">        mass_2               : Lighter compact object of the binary, unit: Mo (solar mass)</span>
<span class="sd">                               (flaot array or just float)</span>
<span class="sd">        luminosity_distance  : Distance between detector and binary, unit: Mpc</span>
<span class="sd">        iota                 : Inclination angle of binary orbital plane wrt to the line of sight. unit: rad</span>
<span class="sd">        psi                  : Polarization angle. unit: rad</span>
<span class="sd">        phase                : Phase of GW at the the time of coalesence, unit: rad</span>
<span class="sd">        geocent_time         : GPS time of colescence of that GW, unit: sec</span>
<span class="sd">        ra                   : Right ascention of source position, unit: rad</span>
<span class="sd">        dec                  : Declination of source position, unit: rad</span>
<span class="sd">        -----------------</span>
<span class="sd">        Return values</span>
<span class="sd">        -----------------</span>
<span class="sd">        opt_snr              : dictionary containing net optimal snr and optimal snr of individual detectors</span>
<span class="sd">                               example of opt_snr_unscaled return values for len(mass_1)=3</span>
<span class="sd">                                {&#39;opt_snr_net&#39;: array([156.53268655, 243.00092419, 292.10396943]),</span>
<span class="sd">                                 &#39;L1&#39;: array([132.08275995, 205.04492349, 246.47822334]),</span>
<span class="sd">                                 &#39;H1&#39;: array([ 84.00372897, 130.40716432, 156.75845871])}</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">mass_1</span><span class="p">,</span> <span class="n">mass_2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">mass_1</span><span class="p">])</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">mass_2</span><span class="p">])</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">size</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">mass_1</span><span class="p">)</span>
        <span class="n">luminosity_distance</span><span class="p">,</span> <span class="n">theta_jn</span><span class="p">,</span> <span class="n">psi</span><span class="p">,</span> <span class="n">phase</span><span class="p">,</span> <span class="n">geocent_time</span><span class="p">,</span> <span class="n">ra</span><span class="p">,</span> <span class="n">dec</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">luminosity_distance</span><span class="p">])</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">size</span><span class="p">),</span>
            <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">iota</span><span class="p">])</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">size</span><span class="p">),</span>
            <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">psi</span><span class="p">])</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">size</span><span class="p">),</span>
            <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">phase</span><span class="p">])</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">size</span><span class="p">),</span>
            <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">geocent_time</span><span class="p">])</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">size</span><span class="p">),</span>
            <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">ra</span><span class="p">])</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">size</span><span class="p">),</span>
            <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">dec</span><span class="p">])</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">size</span><span class="p">),</span>
        <span class="p">)</span>

        <span class="n">Mc</span> <span class="o">=</span> <span class="p">((</span><span class="n">mass_1</span> <span class="o">*</span> <span class="n">mass_2</span><span class="p">)</span> <span class="o">**</span> <span class="p">(</span><span class="mi">3</span> <span class="o">/</span> <span class="mi">5</span><span class="p">))</span> <span class="o">/</span> <span class="p">((</span><span class="n">mass_1</span> <span class="o">+</span> <span class="n">mass_2</span><span class="p">)</span> <span class="o">**</span> <span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="mi">5</span><span class="p">))</span>
        <span class="n">mtot</span> <span class="o">=</span> <span class="n">mass_1</span> <span class="o">+</span> <span class="n">mass_2</span>
        <span class="n">luminosity_distance</span> <span class="o">=</span> <span class="n">luminosity_distance</span>

        <span class="n">snr_half_scaled</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">size</span><span class="p">)</span>
        <span class="c1"># select only those that have inspiral part above f_min</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">waveform_inspiral_must_be_above_fmin</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">approx_duration</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">findchirp_chirptime</span><span class="p">(</span><span class="n">mass_1</span><span class="p">,</span> <span class="n">mass_2</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">f_min</span><span class="p">)</span>
            <span class="n">idx2</span> <span class="o">=</span> <span class="n">approx_duration</span> <span class="o">&gt;</span> <span class="mf">0.0</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">idx2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">(</span><span class="n">size</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>

        <span class="n">idx2</span> <span class="o">=</span> <span class="n">idx2</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">mtot</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mtot_min</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">mtot</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mtot_max</span><span class="p">)</span>

        <span class="n">A1</span> <span class="o">=</span> <span class="n">Mc</span> <span class="o">**</span> <span class="p">(</span><span class="mf">5.0</span> <span class="o">/</span> <span class="mf">6.0</span><span class="p">)</span>
        <span class="n">ci_2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">theta_jn</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span>
        <span class="n">ci_param</span> <span class="o">=</span> <span class="p">((</span><span class="mi">1</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">theta_jn</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span>
        <span class="n">detectors</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">list_of_detectors</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

        <span class="n">opt_snr</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;opt_snr_net&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">}</span>

        <span class="n">idx_ratio</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">searchsorted</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ratio</span><span class="p">,</span> <span class="n">mass_2</span> <span class="o">/</span> <span class="n">mass_1</span><span class="p">)</span>
        <span class="n">idx_tracker</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">size</span><span class="p">)</span>
        <span class="n">idx_tracker</span> <span class="o">=</span> <span class="n">idx_tracker</span><span class="p">[</span><span class="n">idx2</span><span class="p">]</span>
        <span class="c1"># self.idx_ratio = idx_ratio</span>
        <span class="c1"># loop wrt detectors</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">detectors</span><span class="p">)):</span>
            <span class="n">det</span> <span class="o">=</span> <span class="n">detectors</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="c1"># get interpolated half_snr for the required detector</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">interpolator_dict</span><span class="p">[</span><span class="n">det</span><span class="p">],</span> <span class="s2">&quot;rb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">handle</span><span class="p">:</span>
                <span class="n">halfSNR_interpolator</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">handle</span><span class="p">)</span>

            <span class="c1"># calculation of snr_half_scaled for particular detector at the required mtot</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">idx_tracker</span><span class="p">:</span>
                <span class="n">snr_half_scaled</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">halfSNR_interpolator</span><span class="p">[</span><span class="n">idx_ratio</span><span class="p">[</span><span class="n">j</span><span class="p">]](</span>
                    <span class="n">mtot</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
                <span class="p">)</span>  <span class="c1"># i is iterator wrt detectors</span>

            <span class="n">Deff1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">size</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">ra</span><span class="p">)):</span>
                <span class="n">Fp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ifos</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">antenna_response</span><span class="p">(</span>
                    <span class="n">ra</span><span class="p">[</span><span class="n">k</span><span class="p">],</span> <span class="n">dec</span><span class="p">[</span><span class="n">k</span><span class="p">],</span> <span class="n">geocent_time</span><span class="p">[</span><span class="n">k</span><span class="p">],</span> <span class="n">psi</span><span class="p">[</span><span class="n">k</span><span class="p">],</span> <span class="s2">&quot;plus&quot;</span>
                <span class="p">)</span>
                <span class="n">Fc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ifos</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">antenna_response</span><span class="p">(</span>
                    <span class="n">ra</span><span class="p">[</span><span class="n">k</span><span class="p">],</span> <span class="n">dec</span><span class="p">[</span><span class="n">k</span><span class="p">],</span> <span class="n">geocent_time</span><span class="p">[</span><span class="n">k</span><span class="p">],</span> <span class="n">psi</span><span class="p">[</span><span class="n">k</span><span class="p">],</span> <span class="s2">&quot;cross&quot;</span>
                <span class="p">)</span>
                <span class="n">Deff1</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">luminosity_distance</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span>
                    <span class="n">Fp</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="n">ci_param</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">+</span> <span class="n">Fc</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="n">ci_2</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
                <span class="p">)</span>

            <span class="n">opt_snr</span><span class="p">[</span><span class="n">det</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">A1</span> <span class="o">/</span> <span class="n">Deff1</span><span class="p">)</span> <span class="o">*</span> <span class="n">snr_half_scaled</span>
            <span class="n">opt_snr</span><span class="p">[</span><span class="s2">&quot;opt_snr_net&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="n">opt_snr</span><span class="p">[</span><span class="n">det</span><span class="p">]</span> <span class="o">**</span> <span class="mi">2</span>

        <span class="n">opt_snr</span><span class="p">[</span><span class="s2">&quot;opt_snr_net&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">opt_snr</span><span class="p">[</span><span class="s2">&quot;opt_snr_net&quot;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stored_snrs</span> <span class="o">=</span> <span class="n">opt_snr</span>  <span class="c1"># this stored snrs can be use for Pdet calculation</span>

        <span class="c1"># saving as json file</span>
        <span class="k">if</span> <span class="n">jsonFile</span><span class="p">:</span>
            <span class="n">parameters_dict</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s2">&quot;mass_1&quot;</span><span class="p">:</span> <span class="n">mass_1</span><span class="p">,</span>
                <span class="s2">&quot;mass_2&quot;</span><span class="p">:</span> <span class="n">mass_2</span><span class="p">,</span>
                <span class="s2">&quot;luminosity_distance&quot;</span><span class="p">:</span> <span class="n">luminosity_distance</span><span class="p">,</span>
                <span class="s2">&quot;theta_jn&quot;</span><span class="p">:</span> <span class="n">theta_jn</span><span class="p">,</span>
                <span class="s2">&quot;psi&quot;</span><span class="p">:</span> <span class="n">psi</span><span class="p">,</span>
                <span class="s2">&quot;phase&quot;</span><span class="p">:</span> <span class="n">phase</span><span class="p">,</span>
                <span class="s2">&quot;ra&quot;</span><span class="p">:</span> <span class="n">ra</span><span class="p">,</span>
                <span class="s2">&quot;dec&quot;</span><span class="p">:</span> <span class="n">dec</span><span class="p">,</span>
                <span class="s2">&quot;geocent_time&quot;</span><span class="p">:</span> <span class="n">geocent_time</span><span class="p">,</span>
            <span class="p">}</span>
            <span class="n">parameters_dict</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">opt_snr</span><span class="p">)</span>
            <span class="n">file_name</span> <span class="o">=</span> <span class="s2">&quot;./bilby_GWparams_interpolatedSNRs.json&quot;</span>
            <span class="n">json_dump</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">parameters_dict</span><span class="p">,</span> <span class="bp">cls</span><span class="o">=</span><span class="n">NumpyEncoder</span><span class="p">)</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">file_name</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">write_file</span><span class="p">:</span>
                <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">json_dump</span><span class="p">),</span> <span class="n">write_file</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>

        <span class="c1"># how to load data form .json file</span>
        <span class="c1"># f = open (&#39;data.json&#39;, &quot;r&quot;)</span>
        <span class="c1"># data = json.loads(f.read())</span>

        <span class="k">return</span> <span class="n">opt_snr</span>

    <span class="c1">####################################################</span>
    <span class="c1">#                                                  #</span>
    <span class="c1">#   half_snr vs mtot table for interpolation       #</span>
    <span class="c1">#                                                  #</span>
    <span class="c1">####################################################</span>
    <span class="k">def</span> <span class="nf">bns_horizon</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">snr_threshold</span><span class="o">=</span><span class="mf">8.0</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Function for finding detector horizon distance for BNS (m1=m2=1.4)</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        snr_threshold : float</span>
<span class="sd">            SNR threshold for the horizon distance</span>
<span class="sd">            default: 8.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        horizon : array</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">detectors</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">list_of_detectors</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

        <span class="c1"># geocent_time cannot be array here</span>
        <span class="c1"># this geocent_time is only to get halfScaledSNR</span>
        <span class="n">geocent_time_</span> <span class="o">=</span> <span class="mf">1246527224.169434</span>  <span class="c1"># random time from O3</span>

        <span class="n">iota_</span><span class="p">,</span> <span class="n">ra_</span><span class="p">,</span> <span class="n">dec_</span><span class="p">,</span> <span class="n">psi_</span><span class="p">,</span> <span class="n">phase_</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span>
        <span class="n">luminosity_distance_</span> <span class="o">=</span> <span class="mf">100.0</span>
        <span class="n">q</span> <span class="o">=</span> <span class="mf">1.0</span>
        <span class="n">mass_1_</span> <span class="o">=</span> <span class="mf">1.4</span>
        <span class="n">mass_2_</span> <span class="o">=</span> <span class="n">mass_1_</span> <span class="o">*</span> <span class="n">q</span>

        <span class="c1">######## calling bilby_snr ########</span>
        <span class="n">opt_snr_unscaled</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">compute_bilby_snr_</span><span class="p">(</span>
            <span class="n">mass_1</span><span class="o">=</span><span class="n">mass_1_</span><span class="p">,</span>
            <span class="n">mass_2</span><span class="o">=</span><span class="n">mass_2_</span><span class="p">,</span>
            <span class="n">luminosity_distance</span><span class="o">=</span><span class="n">luminosity_distance_</span><span class="p">,</span>
            <span class="n">theta_jn</span><span class="o">=</span><span class="n">iota_</span><span class="p">,</span>
            <span class="n">psi</span><span class="o">=</span><span class="n">psi_</span><span class="p">,</span>
            <span class="n">ra</span><span class="o">=</span><span class="n">ra_</span><span class="p">,</span>
            <span class="n">dec</span><span class="o">=</span><span class="n">dec_</span><span class="p">,</span>
            <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">jsonFile</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="c1">######## filling in interpolation table for different detectors ########</span>
        <span class="n">horizon</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">detectors</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">detectors</span><span class="p">)):</span>
            <span class="n">Fp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ifos</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">antenna_response</span><span class="p">(</span><span class="n">ra_</span><span class="p">,</span> <span class="n">dec_</span><span class="p">,</span> <span class="n">geocent_time_</span><span class="p">,</span> <span class="n">psi_</span><span class="p">,</span> <span class="s2">&quot;plus&quot;</span><span class="p">)</span>
            <span class="n">Fc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ifos</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">antenna_response</span><span class="p">(</span><span class="n">ra_</span><span class="p">,</span> <span class="n">dec_</span><span class="p">,</span> <span class="n">geocent_time_</span><span class="p">,</span> <span class="n">psi_</span><span class="p">,</span> <span class="s2">&quot;cross&quot;</span><span class="p">)</span>
            <span class="n">Deff2</span> <span class="o">=</span> <span class="n">luminosity_distance_</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span>
                <span class="n">Fp</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="p">((</span><span class="mi">1</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">iota_</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span>
                <span class="o">+</span> <span class="n">Fc</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">iota_</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span>
            <span class="p">)</span>

            <span class="n">horizon</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">Deff2</span> <span class="o">/</span> <span class="n">snr_threshold</span><span class="p">)</span> <span class="o">*</span> <span class="n">opt_snr_unscaled</span><span class="p">[</span><span class="n">detectors</span><span class="p">[</span><span class="n">j</span><span class="p">]]</span>

        <span class="k">return</span> <span class="n">horizon</span>

    <span class="c1">####################################################</span>
    <span class="c1">#                                                  #</span>
    <span class="c1">#   half_snr vs mtot table for interpolation       #</span>
    <span class="c1">#                                                  #</span>
    <span class="c1">####################################################</span>
    <span class="k">def</span> <span class="nf">init_halfScaled</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        None</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">mtot_min</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mtot_min</span>
        <span class="n">mtot_max</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mtot_max</span>
        <span class="n">nsamples</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nsamples</span>
        <span class="n">detectors</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">list_of_detectors</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Generating interpolator for </span><span class="si">{</span><span class="n">detectors</span><span class="si">}</span><span class="s2"> detectors&quot;</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">mtot_min</span> <span class="o">&lt;</span> <span class="mf">1.0</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Error: mass too low&quot;</span><span class="p">)</span>

        <span class="n">f_min</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">f_min</span>

        <span class="c1"># geocent_time cannot be array here</span>
        <span class="c1"># this geocent_time is only to get halfScaledSNR</span>
        <span class="n">geocent_time_</span> <span class="o">=</span> <span class="mf">1246527224.169434</span>  <span class="c1"># random time from O3</span>

        <span class="n">iota_</span><span class="p">,</span> <span class="n">ra_</span><span class="p">,</span> <span class="n">dec_</span><span class="p">,</span> <span class="n">psi_</span><span class="p">,</span> <span class="n">phase_</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span>
        <span class="n">luminosity_distance_</span> <span class="o">=</span> <span class="mf">100.0</span>

        <span class="n">ratio</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ratio</span>
        <span class="n">snrHalf_</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">ratio</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">detectors</span><span class="p">)),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">object</span><span class="p">)</span>
        <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">q</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span>
            <span class="n">ratio</span><span class="p">,</span>
            <span class="n">desc</span><span class="o">=</span><span class="s2">&quot;interpolation for each mass_ratios&quot;</span><span class="p">,</span>
            <span class="n">total</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">ratio</span><span class="p">),</span>
            <span class="n">ncols</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span>
        <span class="p">):</span>
            <span class="n">mass_ratio</span> <span class="o">=</span> <span class="n">q</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">waveform_inspiral_must_be_above_fmin</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
                <span class="n">func</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">findchirp_chirptime</span><span class="p">(</span>
                    <span class="n">x</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">mass_ratio</span><span class="p">),</span> <span class="n">x</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">mass_ratio</span><span class="p">)</span> <span class="o">*</span> <span class="n">mass_ratio</span><span class="p">,</span> <span class="n">f_min</span>
                <span class="p">)</span>
                <span class="n">mtot_max</span> <span class="o">=</span> <span class="n">fsolve</span><span class="p">(</span><span class="n">func</span><span class="p">,</span> <span class="mi">150</span><span class="p">)[</span>
                    <span class="mi">0</span>
                <span class="p">]</span>  <span class="c1"># to make sure that chirptime is not negative, TaylorF2 might need this</span>

            <span class="c1"># mtot_table = np.linspace(mtot_min,  mtot_max, nsamples)</span>
            <span class="n">mtot_table</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span>
                <span class="n">mtot_min</span> <span class="o">+</span> <span class="n">mtot_max</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">geomspace</span><span class="p">(</span><span class="n">mtot_min</span><span class="p">,</span> <span class="n">mtot_max</span><span class="p">,</span> <span class="n">nsamples</span><span class="p">)</span>
            <span class="p">)</span>
            <span class="c1"># mtot_table = np.sort(mtot_min+mtot_max-np.geomspace(mtot_min,  mtot_max, nsamples))</span>
            <span class="n">mass_1_</span> <span class="o">=</span> <span class="n">mtot_table</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">q</span><span class="p">)</span>
            <span class="n">mass_2_</span> <span class="o">=</span> <span class="n">mass_1_</span> <span class="o">*</span> <span class="n">q</span>
            <span class="n">mchirp</span> <span class="o">=</span> <span class="p">((</span><span class="n">mass_1_</span> <span class="o">*</span> <span class="n">mass_2_</span><span class="p">)</span> <span class="o">**</span> <span class="p">(</span><span class="mi">3</span> <span class="o">/</span> <span class="mi">5</span><span class="p">))</span> <span class="o">/</span> <span class="p">((</span><span class="n">mtot_table</span><span class="p">)</span> <span class="o">**</span> <span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="mi">5</span><span class="p">))</span>
            <span class="c1">######## calling bilby_snr ########</span>
            <span class="n">opt_snr_unscaled</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">compute_bilby_snr_</span><span class="p">(</span>
                <span class="n">mass_1</span><span class="o">=</span><span class="n">mass_1_</span><span class="p">,</span>
                <span class="n">mass_2</span><span class="o">=</span><span class="n">mass_2_</span><span class="p">,</span>
                <span class="n">luminosity_distance</span><span class="o">=</span><span class="n">luminosity_distance_</span><span class="p">,</span>
                <span class="n">theta_jn</span><span class="o">=</span><span class="n">iota_</span><span class="p">,</span>
                <span class="n">psi</span><span class="o">=</span><span class="n">psi_</span><span class="p">,</span>
                <span class="n">ra</span><span class="o">=</span><span class="n">ra_</span><span class="p">,</span>
                <span class="n">dec</span><span class="o">=</span><span class="n">dec_</span><span class="p">,</span>
                <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                <span class="n">jsonFile</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="p">)</span>

            <span class="n">A2</span> <span class="o">=</span> <span class="n">mchirp</span> <span class="o">**</span> <span class="p">(</span><span class="mf">5.0</span> <span class="o">/</span> <span class="mf">6.0</span><span class="p">)</span>
            <span class="c1">######## filling in interpolation table for different detectors ########</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">detectors</span><span class="p">)):</span>
                <span class="n">Fp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ifos</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">antenna_response</span><span class="p">(</span>
                    <span class="n">ra_</span><span class="p">,</span> <span class="n">dec_</span><span class="p">,</span> <span class="n">geocent_time_</span><span class="p">,</span> <span class="n">psi_</span><span class="p">,</span> <span class="s2">&quot;plus&quot;</span>
                <span class="p">)</span>
                <span class="n">Fc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ifos</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">antenna_response</span><span class="p">(</span>
                    <span class="n">ra_</span><span class="p">,</span> <span class="n">dec_</span><span class="p">,</span> <span class="n">geocent_time_</span><span class="p">,</span> <span class="n">psi_</span><span class="p">,</span> <span class="s2">&quot;cross&quot;</span>
                <span class="p">)</span>
                <span class="n">Deff2</span> <span class="o">=</span> <span class="n">luminosity_distance_</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span>
                    <span class="n">Fp</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="p">((</span><span class="mi">1</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">iota_</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span>
                    <span class="o">+</span> <span class="n">Fc</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">iota_</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span>
                <span class="p">)</span>

                <span class="n">snrHalf_</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">interp1d</span><span class="p">(</span>
                    <span class="n">mtot_table</span><span class="p">,</span>
                    <span class="p">(</span><span class="n">Deff2</span> <span class="o">/</span> <span class="n">A2</span><span class="p">)</span> <span class="o">*</span> <span class="n">opt_snr_unscaled</span><span class="p">[</span><span class="n">detectors</span><span class="p">[</span><span class="n">j</span><span class="p">]],</span>
                    <span class="n">kind</span><span class="o">=</span><span class="s2">&quot;cubic&quot;</span><span class="p">,</span>
                <span class="p">)</span>

            <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>  <span class="c1"># iterator over mass_ratio</span>

        <span class="c1"># save the interpolators for each detectors</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">detectors</span><span class="p">)):</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">interpolator_dict</span><span class="p">[</span><span class="n">detectors</span><span class="p">[</span><span class="n">j</span><span class="p">]],</span> <span class="s2">&quot;wb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">handle</span><span class="p">:</span>
                <span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">snrHalf_</span><span class="p">[:,</span> <span class="n">j</span><span class="p">],</span> <span class="n">handle</span><span class="p">,</span> <span class="n">protocol</span><span class="o">=</span><span class="n">pickle</span><span class="o">.</span><span class="n">HIGHEST_PROTOCOL</span><span class="p">)</span>

        <span class="k">return</span> <span class="kc">None</span>

    <span class="c1">####################################################</span>
    <span class="c1">#                                                  #</span>
    <span class="c1">#                    bilby snr                     #</span>
    <span class="c1">#                                                  #</span>
    <span class="c1">####################################################</span>
    <span class="k">def</span> <span class="nf">compute_bilby_snr_</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">mass_1</span><span class="p">,</span>
        <span class="n">mass_2</span><span class="p">,</span>
        <span class="n">luminosity_distance</span><span class="o">=</span><span class="mf">100.0</span><span class="p">,</span>
        <span class="n">theta_jn</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
        <span class="n">psi</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
        <span class="n">phase</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
        <span class="n">geocent_time</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([]),</span>
        <span class="n">ra</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
        <span class="n">dec</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
        <span class="n">a_1</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
        <span class="n">a_2</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
        <span class="n">tilt_1</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
        <span class="n">tilt_2</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
        <span class="n">phi_12</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
        <span class="n">phi_jl</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
        <span class="n">psds</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">psd_file</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">psd_with_time</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">jsonFile</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        SNR calculated using bilby python package</span>
<span class="sd">        Use for interpolation purpose</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        mass_1 : float</span>
<span class="sd">            The mass of the heavier object in the binary in solar masses.</span>
<span class="sd">        mass_2 : float</span>
<span class="sd">            The mass of the lighter object in the binary in solar masses.</span>
<span class="sd">        luminosity_distance : float</span>
<span class="sd">            The luminosity distance to the binary in megaparsecs.</span>
<span class="sd">        theta_jn : float, optional</span>
<span class="sd">            The angle between the total angular momentum and the line of sight.</span>
<span class="sd">            Default is 0.</span>
<span class="sd">        psi : float, optional</span>
<span class="sd">            The gravitational wave polarisation angle.</span>
<span class="sd">            Default is 0.</span>
<span class="sd">        phase : float, optional</span>
<span class="sd">            The gravitational wave phase at coalescence.</span>
<span class="sd">            Default is 0.</span>
<span class="sd">        geocent_time : float, optional</span>
<span class="sd">            The GPS time of coalescence.</span>
<span class="sd">            Default is 1249852157.0.</span>
<span class="sd">        ra : float, optional</span>
<span class="sd">            The right ascension of the source.</span>
<span class="sd">            Default is 0.</span>
<span class="sd">        dec : float, optional</span>
<span class="sd">            The declination of the source.</span>
<span class="sd">            Default is 0.</span>
<span class="sd">        a_1 : float, optional</span>
<span class="sd">            The spin magnitude of the heavier object in the binary.</span>
<span class="sd">            Default is 0.</span>
<span class="sd">        tilt_1 : float, optional</span>
<span class="sd">            The tilt angle of the heavier object in the binary.</span>
<span class="sd">            Default is 0.</span>
<span class="sd">        phi_12 : float, optional</span>
<span class="sd">            The azimuthal angle between the two spins.</span>
<span class="sd">            Default is 0.</span>
<span class="sd">        a_2 : float, optional</span>
<span class="sd">            The spin magnitude of the lighter object in the binary.</span>
<span class="sd">            Default is 0.</span>
<span class="sd">        tilt_2 : float, optional</span>
<span class="sd">            The tilt angle of the lighter object in the binary.</span>
<span class="sd">            Default is 0.</span>
<span class="sd">        phi_jl : float, optional</span>
<span class="sd">            The azimuthal angle between the total angular momentum and the orbital angular momentum.</span>
<span class="sd">            Default is 0.</span>
<span class="sd">        psds : dict, optional</span>
<span class="sd">            psd dict. if set False will get the values set at class initialization</span>
<span class="sd">            example_1=&gt; when values are psd name from pycbc analytical psds,</span>
<span class="sd">            psds={&#39;L1&#39;:&#39;aLIGOaLIGODesignSensitivityT1800044&#39;,&#39;H1&#39;:&#39;aLIGOaLIGODesignSensitivityT1800044&#39;}</span>
<span class="sd">            example_2=&gt; when values are psd txt file in bilby or custom created,</span>
<span class="sd">            psds={&#39;L1&#39;:&#39;aLIGO_O4_high_asd.txt&#39;,&#39;H1&#39;:&#39;aLIGO_O4_high_asd.txt&#39;}</span>
<span class="sd">            custom created txt file has two columns. 1st column: frequency array, 2nd column: strain</span>
<span class="sd">        psd_file : bool, optional</span>
<span class="sd">            if set True, the given value of psds param should be of psds instead of asd. If asd, set psd_file=False.</span>
<span class="sd">            e.g. if psd is {&#39;L1&#39;:&#39;aLIGO_O4_high_asd.txt&#39;,&#39;H1&#39;:&#39;aLIGO_early_high_psd.txt&#39;}, then psd_file = [False,True].</span>
<span class="sd">        psd_with_time : float, optional</span>
<span class="sd">            gps end time end strain data for which psd will be found. (this param will be given highest priority)</span>
<span class="sd">            example=&gt; psd_with_time=1246527224.169434</span>
<span class="sd">        verbose : bool, optional</span>
<span class="sd">            If true, print the SNR.</span>
<span class="sd">            Default is True.</span>
<span class="sd">        jsonFile : bool, optional</span>
<span class="sd">            If true, save the SNR parameters and values in a json file.</span>
<span class="sd">            Default is False.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        snr_dict : dict</span>
<span class="sd">            dictionary containing net optimal snr and optimal snr of individual detectors</span>
<span class="sd">            example of opt_snr_unscaled return values for len(mass_1)=3</span>
<span class="sd">            {&#39;opt_snr_net&#39;: array([156.53268655, 243.00092419, 292.10396943]),</span>
<span class="sd">            &#39;L1&#39;: array([132.08275995, 205.04492349, 246.47822334]),</span>
<span class="sd">            &#39;H1&#39;: array([ 84.00372897, 130.40716432, 156.75845871])}</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">npool</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">npool</span>
        <span class="n">geocent_time_</span> <span class="o">=</span> <span class="mf">1246527224.169434</span>  <span class="c1"># random time from O3</span>
        <span class="n">sampling_frequency</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sampling_frequency</span>
        <span class="k">if</span> <span class="n">psds</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
            <span class="c1"># if psds are not given at the method level get what whatever that was initialized at the class level</span>
            <span class="n">detectors</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">list_of_detectors</span>
            <span class="n">psd_file</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">psd_file</span>
            <span class="n">psds</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">psds</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># if psds are given at the method level</span>
            <span class="n">detectors</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">psds</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        <span class="n">approximant</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">waveform_approximant</span>
        <span class="n">f_min</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">f_min</span>

        <span class="c1">################</span>
        <span class="c1"># psd handling #</span>
        <span class="c1">################</span>
        <span class="c1"># if psds information is not manually given, we will use the one provided in bilby for O3 sensitivity</span>
        <span class="n">psds_arrays</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
        <span class="c1">#######################################</span>
        <span class="c1"># more realistic psds from averaging a segment of gwosc data</span>
        <span class="c1"># psd calculation from gps time point</span>
        <span class="c1"># add exception handling for unrecognised time</span>
        <span class="k">if</span> <span class="n">psd_with_time</span> <span class="o">!=</span> <span class="kc">False</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;wait for sometime while psd data is being fetch...&quot;</span><span class="p">)</span>
            <span class="c1"># Use gwpy to fetch the open data</span>
            <span class="n">duration</span> <span class="o">=</span> <span class="mf">16.0</span>
            <span class="n">roll_off</span> <span class="o">=</span> <span class="mf">0.2</span>
            <span class="n">psd_duration</span> <span class="o">=</span> <span class="n">duration</span> <span class="o">*</span> <span class="mf">32.0</span>  <span class="c1"># uint (seconds)</span>
            <span class="n">psd_start_time</span> <span class="o">=</span> <span class="n">psd_with_time</span> <span class="o">-</span> <span class="n">psd_duration</span>
            <span class="k">for</span> <span class="n">ifo</span> <span class="ow">in</span> <span class="n">detectors</span><span class="p">:</span>
                <span class="n">psd_data</span> <span class="o">=</span> <span class="n">TimeSeries</span><span class="o">.</span><span class="n">fetch_open_data</span><span class="p">(</span>
                    <span class="n">ifo</span><span class="p">,</span>
                    <span class="n">psd_start_time</span><span class="p">,</span>
                    <span class="n">psd_start_time</span> <span class="o">+</span> <span class="n">psd_duration</span><span class="p">,</span>
                    <span class="n">sample_rate</span><span class="o">=</span><span class="n">sampling_frequency</span><span class="p">,</span>
                    <span class="n">cache</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="p">)</span>

                <span class="n">psd_alpha</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">roll_off</span> <span class="o">/</span> <span class="n">duration</span>
                <span class="n">det_psd</span> <span class="o">=</span> <span class="n">psd_data</span><span class="o">.</span><span class="n">psd</span><span class="p">(</span>
                    <span class="n">fftlength</span><span class="o">=</span><span class="n">duration</span><span class="p">,</span>
                    <span class="n">overlap</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>
                    <span class="n">window</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;tukey&quot;</span><span class="p">,</span> <span class="n">psd_alpha</span><span class="p">),</span>
                    <span class="n">method</span><span class="o">=</span><span class="s2">&quot;median&quot;</span><span class="p">,</span>
                <span class="p">)</span>

                <span class="n">psds_arrays</span><span class="p">[</span><span class="n">ifo</span><span class="p">]</span> <span class="o">=</span> <span class="n">bilby</span><span class="o">.</span><span class="n">gw</span><span class="o">.</span><span class="n">detector</span><span class="o">.</span><span class="n">PowerSpectralDensity</span><span class="p">(</span>
                    <span class="n">frequency_array</span><span class="o">=</span><span class="n">det_psd</span><span class="o">.</span><span class="n">frequencies</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">psd_array</span><span class="o">=</span><span class="n">det_psd</span><span class="o">.</span><span class="n">value</span>
                <span class="p">)</span>
        <span class="c1"># get psd with psd name or with txt file</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c1"># iterator</span>
            <span class="k">for</span> <span class="n">det</span> <span class="ow">in</span> <span class="n">detectors</span><span class="p">:</span>
                <span class="c1"># either provided psd or what&#39;s available in bilby</span>
                <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">psds</span><span class="p">[</span><span class="n">det</span><span class="p">])</span> <span class="o">==</span> <span class="nb">str</span> <span class="ow">and</span> <span class="n">psds</span><span class="p">[</span><span class="n">det</span><span class="p">][</span><span class="o">-</span><span class="mi">3</span><span class="p">:]</span> <span class="o">==</span> <span class="s2">&quot;txt&quot;</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">psd_file</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span>
                        <span class="n">psds_arrays</span><span class="p">[</span><span class="n">det</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">power_spectral_density</span><span class="p">(</span><span class="n">psds</span><span class="p">[</span><span class="n">det</span><span class="p">])</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">psds_arrays</span><span class="p">[</span><span class="n">det</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">amplitude_spectral_density</span><span class="p">(</span><span class="n">psds</span><span class="p">[</span><span class="n">det</span><span class="p">])</span>

                <span class="c1"># name string should be avaible in the list of psds in pycbc</span>
                <span class="k">elif</span> <span class="nb">type</span><span class="p">(</span><span class="n">psds</span><span class="p">[</span><span class="n">det</span><span class="p">])</span> <span class="o">==</span> <span class="nb">str</span><span class="p">:</span>
                    <span class="n">psds_arrays</span><span class="p">[</span><span class="n">det</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">power_spectral_density_pycbc</span><span class="p">(</span><span class="n">psds</span><span class="p">[</span><span class="n">det</span><span class="p">])</span>

                <span class="k">else</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span>
                        <span class="s2">&quot;the psds format is not recognised. The parameter psds dict should contain chosen detector names as keys </span><span class="se">\</span>
<span class="s2">                            and corresponding psds txt file name (or name from pycbc psd)as their values&#39;&quot;</span>
                    <span class="p">)</span>
                <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>  <span class="c1"># iterator wrt detectors</span>

        <span class="c1">#######################################</span>
        <span class="c1"># check whether there is input for geocent_time</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">geocent_time</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">():</span>
            <span class="n">geocent_time</span> <span class="o">=</span> <span class="n">geocent_time_</span>

        <span class="c1"># reshape(-1) is so that either a float value is given or the input is an numpy array</span>
        <span class="c1"># np.ones is multipled to make sure everything is of same length</span>
        <span class="n">mass_1</span><span class="p">,</span> <span class="n">mass_2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">mass_1</span><span class="p">])</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">mass_2</span><span class="p">])</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">num</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">mass_1</span><span class="p">)</span>
        <span class="c1"># reshaping other parameters</span>
        <span class="p">(</span>
            <span class="n">luminosity_distance</span><span class="p">,</span>
            <span class="n">theta_jn</span><span class="p">,</span>
            <span class="n">psi</span><span class="p">,</span>
            <span class="n">phase</span><span class="p">,</span>
            <span class="n">geocent_time</span><span class="p">,</span>
            <span class="n">ra</span><span class="p">,</span>
            <span class="n">dec</span><span class="p">,</span>
            <span class="n">a_1</span><span class="p">,</span>
            <span class="n">a_2</span><span class="p">,</span>
            <span class="n">tilt_1</span><span class="p">,</span>
            <span class="n">tilt_2</span><span class="p">,</span>
            <span class="n">phi_12</span><span class="p">,</span>
            <span class="n">phi_jl</span><span class="p">,</span>
        <span class="p">)</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">luminosity_distance</span><span class="p">])</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">num</span><span class="p">),</span>
            <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">theta_jn</span><span class="p">])</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">num</span><span class="p">),</span>
            <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">psi</span><span class="p">])</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">num</span><span class="p">),</span>
            <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">phase</span><span class="p">])</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">num</span><span class="p">),</span>
            <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">geocent_time</span><span class="p">])</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">num</span><span class="p">),</span>
            <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">ra</span><span class="p">])</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">num</span><span class="p">),</span>
            <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">dec</span><span class="p">])</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">num</span><span class="p">),</span>
            <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">a_1</span><span class="p">])</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">num</span><span class="p">),</span>
            <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">a_2</span><span class="p">])</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">num</span><span class="p">),</span>
            <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">tilt_1</span><span class="p">])</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">num</span><span class="p">),</span>
            <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">tilt_2</span><span class="p">])</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">num</span><span class="p">),</span>
            <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">phi_12</span><span class="p">])</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">num</span><span class="p">),</span>
            <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">phi_jl</span><span class="p">])</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">num</span><span class="p">),</span>
        <span class="p">)</span>

        <span class="n">iter_</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">SNRs_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">SNRs_dict</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="c1"># time duration calculation for each of the mass combination</span>
        <span class="n">safety</span> <span class="o">=</span> <span class="mf">1.2</span>
        <span class="n">approx_duration</span> <span class="o">=</span> <span class="n">safety</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">findchirp_chirptime</span><span class="p">(</span><span class="n">mass_1</span><span class="p">,</span> <span class="n">mass_2</span><span class="p">,</span> <span class="n">f_min</span><span class="p">)</span>
        <span class="n">duration</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">approx_duration</span> <span class="o">+</span> <span class="mf">2.0</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">waveform_inspiral_must_be_above_fmin</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
            <span class="c1"># select only those that have inspiral part above f_min</span>
            <span class="n">idx</span> <span class="o">=</span> <span class="n">approx_duration</span> <span class="o">&gt;</span> <span class="mf">0.0</span>

            <span class="c1"># setting up parameters for feeding the inner product calculator (multiprocessing)</span>
            <span class="n">size1</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">mass_1</span><span class="p">)</span>
            <span class="n">size2</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span>
                <span class="n">mass_1</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>
            <span class="p">)</span>  <span class="c1"># chossing only those that have inspiral part above f_min</span>
            <span class="n">iterations</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">size1</span><span class="p">)</span>  <span class="c1"># to keep track of index</span>
            <span class="n">iterations</span> <span class="o">=</span> <span class="n">iterations</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>  <span class="c1"># to keep track of index</span>

            <span class="n">dectectorList</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">detectors</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span>
                <span class="p">(</span><span class="n">size2</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">detectors</span><span class="p">)),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">object</span>
            <span class="p">)</span>
            <span class="n">psds_arrays_list</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">(</span><span class="n">size2</span><span class="p">,</span> <span class="n">psds_arrays</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">object</span><span class="p">)])</span><span class="o">.</span><span class="n">T</span>

            <span class="n">input_arguments</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
                <span class="p">[</span>
                    <span class="n">mass_1</span><span class="p">[</span><span class="n">idx</span><span class="p">],</span>
                    <span class="n">mass_2</span><span class="p">[</span><span class="n">idx</span><span class="p">],</span>
                    <span class="n">luminosity_distance</span><span class="p">[</span><span class="n">idx</span><span class="p">],</span>
                    <span class="n">theta_jn</span><span class="p">[</span><span class="n">idx</span><span class="p">],</span>
                    <span class="n">psi</span><span class="p">[</span><span class="n">idx</span><span class="p">],</span>
                    <span class="n">phase</span><span class="p">[</span><span class="n">idx</span><span class="p">],</span>
                    <span class="n">ra</span><span class="p">[</span><span class="n">idx</span><span class="p">],</span>
                    <span class="n">dec</span><span class="p">[</span><span class="n">idx</span><span class="p">],</span>
                    <span class="n">geocent_time</span><span class="p">[</span><span class="n">idx</span><span class="p">],</span>
                    <span class="n">a_1</span><span class="p">[</span><span class="n">idx</span><span class="p">],</span>
                    <span class="n">a_2</span><span class="p">[</span><span class="n">idx</span><span class="p">],</span>
                    <span class="n">tilt_1</span><span class="p">[</span><span class="n">idx</span><span class="p">],</span>
                    <span class="n">tilt_2</span><span class="p">[</span><span class="n">idx</span><span class="p">],</span>
                    <span class="n">phi_12</span><span class="p">[</span><span class="n">idx</span><span class="p">],</span>
                    <span class="n">phi_jl</span><span class="p">[</span><span class="n">idx</span><span class="p">],</span>
                    <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">(</span><span class="n">size2</span><span class="p">,</span> <span class="n">approximant</span><span class="p">),</span>
                    <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">(</span><span class="n">size2</span><span class="p">,</span> <span class="n">f_min</span><span class="p">),</span>
                    <span class="n">duration</span><span class="p">[</span><span class="n">idx</span><span class="p">],</span>
                    <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">(</span><span class="n">size2</span><span class="p">,</span> <span class="n">sampling_frequency</span><span class="p">),</span>
                    <span class="n">iterations</span><span class="p">,</span>
                <span class="p">],</span>
                <span class="n">dtype</span><span class="o">=</span><span class="nb">object</span><span class="p">,</span>
            <span class="p">)</span><span class="o">.</span><span class="n">T</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># setting up parameters for feeding the inner product calculator (multiprocessing)</span>
            <span class="n">size1</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">mass_1</span><span class="p">)</span>
            <span class="n">iterations</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">size1</span><span class="p">)</span>  <span class="c1"># to keep track of index</span>

            <span class="n">dectectorList</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">detectors</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span>
                <span class="p">(</span><span class="n">size1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">detectors</span><span class="p">)),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">object</span>
            <span class="p">)</span>
            <span class="n">psds_arrays_list</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">(</span><span class="n">size1</span><span class="p">,</span> <span class="n">psds_arrays</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">object</span><span class="p">)])</span><span class="o">.</span><span class="n">T</span>

            <span class="n">input_arguments</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
                <span class="p">[</span>
                    <span class="n">mass_1</span><span class="p">,</span>
                    <span class="n">mass_2</span><span class="p">,</span>
                    <span class="n">luminosity_distance</span><span class="p">,</span>
                    <span class="n">theta_jn</span><span class="p">,</span>
                    <span class="n">psi</span><span class="p">,</span>
                    <span class="n">phase</span><span class="p">,</span>
                    <span class="n">ra</span><span class="p">,</span>
                    <span class="n">dec</span><span class="p">,</span>
                    <span class="n">geocent_time</span><span class="p">,</span>
                    <span class="n">a_1</span><span class="p">,</span>
                    <span class="n">a_2</span><span class="p">,</span>
                    <span class="n">tilt_1</span><span class="p">,</span>
                    <span class="n">tilt_2</span><span class="p">,</span>
                    <span class="n">phi_12</span><span class="p">,</span>
                    <span class="n">phi_jl</span><span class="p">,</span>
                    <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">(</span><span class="n">size1</span><span class="p">,</span> <span class="n">approximant</span><span class="p">),</span>
                    <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">(</span><span class="n">size1</span><span class="p">,</span> <span class="n">f_min</span><span class="p">),</span>
                    <span class="n">duration</span><span class="p">,</span>
                    <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">(</span><span class="n">size1</span><span class="p">,</span> <span class="n">sampling_frequency</span><span class="p">),</span>
                    <span class="n">iterations</span><span class="p">,</span>
                <span class="p">],</span>
                <span class="n">dtype</span><span class="o">=</span><span class="nb">object</span><span class="p">,</span>
            <span class="p">)</span><span class="o">.</span><span class="n">T</span>

        <span class="n">input_arguments</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span>
            <span class="p">(</span><span class="n">input_arguments</span><span class="p">,</span> <span class="n">psds_arrays_list</span><span class="p">,</span> <span class="n">dectectorList</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span>
        <span class="p">)</span>

        <span class="c1">#######################################</span>
        <span class="c1"># if inspiral only waveform, apply fmax cutoff</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">waveform_type</span> <span class="o">==</span> <span class="s2">&quot;Inspiral&quot;</span><span class="p">:</span>
            <span class="k">with</span> <span class="n">Pool</span><span class="p">(</span><span class="n">processes</span><span class="o">=</span><span class="n">npool</span><span class="p">)</span> <span class="k">as</span> <span class="n">pool</span><span class="p">:</span>
                <span class="c1"># call the same function with different data in parallel</span>
                <span class="c1"># imap-&gt;retain order in the list, while map-&gt;doesn&#39;t</span>
                <span class="k">for</span> <span class="n">result</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span>
                    <span class="n">pool</span><span class="o">.</span><span class="n">imap_unordered</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">snr_with_fmax_cutoff</span><span class="p">,</span> <span class="n">input_arguments</span><span class="p">),</span>
                    <span class="n">total</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">input_arguments</span><span class="p">),</span>
                    <span class="n">ncols</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span>
                    <span class="n">disable</span><span class="o">=</span><span class="ow">not</span> <span class="n">verbose</span><span class="p">,</span>
                <span class="p">):</span>
                    <span class="n">iter_</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                    <span class="n">SNRs_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">with</span> <span class="n">Pool</span><span class="p">(</span><span class="n">processes</span><span class="o">=</span><span class="n">npool</span><span class="p">)</span> <span class="k">as</span> <span class="n">pool</span><span class="p">:</span>
                <span class="c1"># call the same function with different data in parallel</span>
                <span class="c1"># imap-&gt;retain order in the list, while map-&gt;doesn&#39;t</span>
                <span class="k">for</span> <span class="n">result</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span>
                    <span class="n">pool</span><span class="o">.</span><span class="n">imap_unordered</span><span class="p">(</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">noise_weighted_inner_prod</span><span class="p">,</span> <span class="n">input_arguments</span>
                    <span class="p">),</span>
                    <span class="n">total</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">input_arguments</span><span class="p">),</span>
                    <span class="n">ncols</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span>
                    <span class="n">disable</span><span class="o">=</span><span class="ow">not</span> <span class="n">verbose</span><span class="p">,</span>
                <span class="p">):</span>
                    <span class="n">iter_</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                    <span class="n">SNRs_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="c1">#######################################</span>

        <span class="c1"># to fill in the snr values at the right index</span>
        <span class="n">SNRs_list</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">SNRs_list</span><span class="p">)</span>
        <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">det</span> <span class="ow">in</span> <span class="n">detectors</span><span class="p">:</span>
            <span class="n">snrs_</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">size1</span><span class="p">)</span>
            <span class="n">snrs_</span><span class="p">[</span><span class="n">iter_</span><span class="p">]</span> <span class="o">=</span> <span class="n">SNRs_list</span><span class="p">[:,</span> <span class="n">i</span><span class="p">]</span>
            <span class="n">SNRs_dict</span><span class="p">[</span><span class="n">det</span><span class="p">]</span> <span class="o">=</span> <span class="n">snrs_</span>
            <span class="n">i</span> <span class="o">=</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span>

        <span class="n">snrs_</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">size1</span><span class="p">)</span>
        <span class="n">snrs_</span><span class="p">[</span><span class="n">iter_</span><span class="p">]</span> <span class="o">=</span> <span class="n">SNRs_list</span><span class="p">[:,</span> <span class="n">i</span><span class="p">]</span>
        <span class="n">SNRs_dict</span><span class="p">[</span><span class="s2">&quot;opt_snr_net&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">snrs_</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stored_snrs</span> <span class="o">=</span> <span class="n">SNRs_dict</span>  <span class="c1"># this stored snrs can be use for Pdet calculation</span>

        <span class="c1"># saving as json file</span>
        <span class="k">if</span> <span class="n">jsonFile</span><span class="p">:</span>
            <span class="n">parameters_dict</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s2">&quot;mass_1&quot;</span><span class="p">:</span> <span class="n">mass_1</span><span class="p">,</span>
                <span class="s2">&quot;mass_2&quot;</span><span class="p">:</span> <span class="n">mass_2</span><span class="p">,</span>
                <span class="s2">&quot;luminosity_distance&quot;</span><span class="p">:</span> <span class="n">luminosity_distance</span><span class="p">,</span>
                <span class="s2">&quot;theta_jn&quot;</span><span class="p">:</span> <span class="n">theta_jn</span><span class="p">,</span>
                <span class="s2">&quot;psi&quot;</span><span class="p">:</span> <span class="n">psi</span><span class="p">,</span>
                <span class="s2">&quot;phase&quot;</span><span class="p">:</span> <span class="n">phase</span><span class="p">,</span>
                <span class="s2">&quot;ra&quot;</span><span class="p">:</span> <span class="n">ra</span><span class="p">,</span>
                <span class="s2">&quot;dec&quot;</span><span class="p">:</span> <span class="n">dec</span><span class="p">,</span>
                <span class="s2">&quot;geocent_time&quot;</span><span class="p">:</span> <span class="n">geocent_time</span><span class="p">,</span>
                <span class="s2">&quot;a_1&quot;</span><span class="p">:</span> <span class="n">a_1</span><span class="p">,</span>
                <span class="s2">&quot;a_2&quot;</span><span class="p">:</span> <span class="n">a_2</span><span class="p">,</span>
                <span class="s2">&quot;tilt_1&quot;</span><span class="p">:</span> <span class="n">tilt_1</span><span class="p">,</span>
                <span class="s2">&quot;tilt_2&quot;</span><span class="p">:</span> <span class="n">tilt_2</span><span class="p">,</span>
                <span class="s2">&quot;phi_12&quot;</span><span class="p">:</span> <span class="n">phi_12</span><span class="p">,</span>
                <span class="s2">&quot;phi_jl&quot;</span><span class="p">:</span> <span class="n">phi_jl</span><span class="p">,</span>
            <span class="p">}</span>
            <span class="n">parameters_dict</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">SNRs_dict</span><span class="p">)</span>
            <span class="n">file_name</span> <span class="o">=</span> <span class="s2">&quot;./bilby_GWparams_innerproductSNRs.json&quot;</span>
            <span class="n">json_dump</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">parameters_dict</span><span class="p">,</span> <span class="bp">cls</span><span class="o">=</span><span class="n">NumpyEncoder</span><span class="p">)</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">file_name</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">write_file</span><span class="p">:</span>
                <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">json_dump</span><span class="p">),</span> <span class="n">write_file</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>

        <span class="c1"># how to load data form .json file</span>
        <span class="c1"># f = open (&#39;data.json&#39;, &quot;r&quot;)</span>
        <span class="c1"># data = json.loads(f.read())</span>
        <span class="k">return</span> <span class="n">SNRs_dict</span>

    <span class="c1">####################################################</span>
    <span class="c1">#                                                  #</span>
    <span class="c1">#            psd array finder from bilby           #</span>
    <span class="c1">#                                                  #</span>
    <span class="c1">####################################################</span>
    <span class="k">def</span> <span class="nf">power_spectral_density</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">psd</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        psd array finder from bilby</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        psd : str</span>
<span class="sd">            name of the psd</span>
<span class="sd">            e.g. &#39;aLIGO_O4_high_psd.txt&#39;</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        psd_array : bilby.gw.detector.psd.PowerSpectralDensity object</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">bilby</span><span class="o">.</span><span class="n">gw</span><span class="o">.</span><span class="n">detector</span><span class="o">.</span><span class="n">PowerSpectralDensity</span><span class="p">(</span><span class="n">psd_file</span><span class="o">=</span><span class="n">psd</span><span class="p">)</span>

    <span class="c1">####################################################</span>
    <span class="c1">#                                                  #</span>
    <span class="c1">#            asd array finder from bilby           #</span>
    <span class="c1">#                                                  #</span>
    <span class="c1">####################################################</span>
    <span class="k">def</span> <span class="nf">amplitude_spectral_density</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">asd</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        asd array finder from bilby</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        asd : str</span>
<span class="sd">            name of the asd</span>
<span class="sd">            e.g. &#39;aLIGO_O4_high_asd.txt&#39;</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        psd_array : bilby.gw.detector.psd.PowerSpectralDensity object</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">bilby</span><span class="o">.</span><span class="n">gw</span><span class="o">.</span><span class="n">detector</span><span class="o">.</span><span class="n">PowerSpectralDensity</span><span class="p">(</span><span class="n">asd_file</span><span class="o">=</span><span class="n">asd</span><span class="p">)</span>

    <span class="c1">####################################################</span>
    <span class="c1">#                                                  #</span>
    <span class="c1">#            psd array finder from pycbc           #</span>
    <span class="c1">#                                                  #</span>
    <span class="c1">####################################################</span>
    <span class="k">def</span> <span class="nf">power_spectral_density_pycbc</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">psd</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        psd array finder from pycbc</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        psd : str</span>
<span class="sd">            name of the psd</span>
<span class="sd">            e.g. &#39;aLIGOaLIGODesignSensitivityT1800044&#39;</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        psd_array : bilby.gw.detector.psd.PowerSpectralDensity object</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">delta_f</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="mf">16.0</span>
        <span class="n">flen</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sampling_frequency</span> <span class="o">/</span> <span class="n">delta_f</span><span class="p">)</span>
        <span class="n">low_frequency_cutoff</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">f_min</span>
        <span class="n">psd_</span> <span class="o">=</span> <span class="n">pycbc</span><span class="o">.</span><span class="n">psd</span><span class="o">.</span><span class="n">from_string</span><span class="p">(</span><span class="n">psd</span><span class="p">,</span> <span class="n">flen</span><span class="p">,</span> <span class="n">delta_f</span><span class="p">,</span> <span class="n">low_frequency_cutoff</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">bilby</span><span class="o">.</span><span class="n">gw</span><span class="o">.</span><span class="n">detector</span><span class="o">.</span><span class="n">PowerSpectralDensity</span><span class="p">(</span>
            <span class="n">frequency_array</span><span class="o">=</span><span class="n">psd_</span><span class="o">.</span><span class="n">sample_frequencies</span><span class="p">,</span> <span class="n">psd_array</span><span class="o">=</span><span class="n">psd_</span><span class="o">.</span><span class="n">data</span>
        <span class="p">)</span>

    <span class="c1">####################################################</span>
    <span class="c1">#                                                  #</span>
    <span class="c1">#     SNR with f_max cutoff (Multiprocessing)      #</span>
    <span class="c1">#      (needed for inspiral only waveforms)        #</span>
    <span class="c1">#                                                  #</span>
    <span class="c1">####################################################</span>
    <span class="k">def</span> <span class="nf">snr_with_fmax_cutoff</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">params</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Probaility of detection of GW for the given sensitivity of the detectors</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        params : list</span>
<span class="sd">            list of parameters for the inner product calculation</span>
<span class="sd">            List contains: \n</span>
<span class="sd">            params[0] : float</span>
<span class="sd">                mass_1</span>
<span class="sd">            params[1] : float</span>
<span class="sd">                mass_2</span>
<span class="sd">            params[2] : float</span>
<span class="sd">                luminosity_distance</span>
<span class="sd">            params[3] : float</span>
<span class="sd">                theta_jn</span>
<span class="sd">            params[4] : float</span>
<span class="sd">                psi</span>
<span class="sd">            params[5] : float</span>
<span class="sd">                phase</span>
<span class="sd">            params[6] : float</span>
<span class="sd">                ra</span>
<span class="sd">            params[7] : float</span>
<span class="sd">                dec</span>
<span class="sd">            params[8] : float</span>
<span class="sd">                geocent_time</span>
<span class="sd">            params[9] : float</span>
<span class="sd">                a_1</span>
<span class="sd">            params[10] : float</span>
<span class="sd">                a_2</span>
<span class="sd">            params[11] : float</span>
<span class="sd">                tilt_1</span>
<span class="sd">            params[12] : float</span>
<span class="sd">                tilt_2</span>
<span class="sd">            params[13] : float</span>
<span class="sd">                phi_12</span>
<span class="sd">            params[14] : float</span>
<span class="sd">                phi_jl</span>
<span class="sd">            params[15] : float</span>
<span class="sd">                approximant</span>
<span class="sd">            params[16] : float</span>
<span class="sd">                f_min</span>
<span class="sd">            params[17] : float</span>
<span class="sd">                duration</span>
<span class="sd">            params[18] : float</span>
<span class="sd">                sampling_frequency</span>
<span class="sd">            params[19] : int</span>
<span class="sd">                index tracker</span>
<span class="sd">            psds_list[20] : list</span>
<span class="sd">                list of psds for each detector</span>
<span class="sd">            detector_list[21:] : list</span>
<span class="sd">                list of detectors</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        SNRs_list : list</span>
<span class="sd">            contains opt_snr for each detector and net_opt_snr</span>
<span class="sd">        params[19] : int</span>
<span class="sd">            index tracker</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">bilby</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">disabled</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">88170235</span><span class="p">)</span>
        <span class="n">parameters</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;mass_1&quot;</span><span class="p">:</span> <span class="n">params</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
            <span class="s2">&quot;mass_2&quot;</span><span class="p">:</span> <span class="n">params</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
            <span class="s2">&quot;luminosity_distance&quot;</span><span class="p">:</span> <span class="n">params</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span>
            <span class="s2">&quot;theta_jn&quot;</span><span class="p">:</span> <span class="n">params</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span>
            <span class="s2">&quot;psi&quot;</span><span class="p">:</span> <span class="n">params</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span>
            <span class="s2">&quot;phase&quot;</span><span class="p">:</span> <span class="n">params</span><span class="p">[</span><span class="mi">5</span><span class="p">],</span>
            <span class="s2">&quot;geocent_time&quot;</span><span class="p">:</span> <span class="n">params</span><span class="p">[</span><span class="mi">8</span><span class="p">],</span>
            <span class="s2">&quot;ra&quot;</span><span class="p">:</span> <span class="n">params</span><span class="p">[</span><span class="mi">6</span><span class="p">],</span>
            <span class="s2">&quot;dec&quot;</span><span class="p">:</span> <span class="n">params</span><span class="p">[</span><span class="mi">7</span><span class="p">],</span>
            <span class="s2">&quot;a_1&quot;</span><span class="p">:</span> <span class="n">params</span><span class="p">[</span><span class="mi">9</span><span class="p">],</span>
            <span class="s2">&quot;a_2&quot;</span><span class="p">:</span> <span class="n">params</span><span class="p">[</span><span class="mi">10</span><span class="p">],</span>
            <span class="s2">&quot;tilt_1&quot;</span><span class="p">:</span> <span class="n">params</span><span class="p">[</span><span class="mi">11</span><span class="p">],</span>
            <span class="s2">&quot;tilt_2&quot;</span><span class="p">:</span> <span class="n">params</span><span class="p">[</span><span class="mi">12</span><span class="p">],</span>
            <span class="s2">&quot;phi_12&quot;</span><span class="p">:</span> <span class="n">params</span><span class="p">[</span><span class="mi">13</span><span class="p">],</span>
            <span class="s2">&quot;phi_jl&quot;</span><span class="p">:</span> <span class="n">params</span><span class="p">[</span><span class="mi">14</span><span class="p">],</span>
        <span class="p">}</span>

        <span class="n">f_min</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="mi">16</span><span class="p">]</span>
        <span class="n">f_max</span> <span class="o">=</span> <span class="p">(</span><span class="n">C</span><span class="o">**</span><span class="mi">3</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span>
            <span class="n">G</span> <span class="o">*</span> <span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">params</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">*</span> <span class="n">Mo</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="mi">6</span> <span class="o">**</span> <span class="p">(</span><span class="mi">3</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
        <span class="p">)</span>  <span class="c1"># last stable orbit frequency</span>
        <span class="n">waveform_arguments</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
            <span class="n">waveform_approximant</span><span class="o">=</span><span class="n">params</span><span class="p">[</span><span class="mi">15</span><span class="p">],</span>
            <span class="n">reference_frequency</span><span class="o">=</span><span class="mf">20.0</span><span class="p">,</span>
            <span class="n">minimum_frequency</span><span class="o">=</span><span class="n">params</span><span class="p">[</span><span class="mi">16</span><span class="p">],</span>
        <span class="p">)</span>

        <span class="n">waveform_generator</span> <span class="o">=</span> <span class="n">bilby</span><span class="o">.</span><span class="n">gw</span><span class="o">.</span><span class="n">WaveformGenerator</span><span class="p">(</span>
            <span class="n">duration</span><span class="o">=</span><span class="n">params</span><span class="p">[</span><span class="mi">17</span><span class="p">],</span>
            <span class="n">sampling_frequency</span><span class="o">=</span><span class="n">params</span><span class="p">[</span><span class="mi">18</span><span class="p">],</span>
            <span class="n">frequency_domain_source_model</span><span class="o">=</span><span class="n">bilby</span><span class="o">.</span><span class="n">gw</span><span class="o">.</span><span class="n">source</span><span class="o">.</span><span class="n">lal_binary_black_hole</span><span class="p">,</span>
            <span class="n">waveform_arguments</span><span class="o">=</span><span class="n">waveform_arguments</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">polas</span> <span class="o">=</span> <span class="n">waveform_generator</span><span class="o">.</span><span class="n">frequency_domain_strain</span><span class="p">(</span><span class="n">parameters</span><span class="o">=</span><span class="n">parameters</span><span class="p">)</span>

        <span class="c1"># f_max for for cutoff</span>
        <span class="n">f_array</span> <span class="o">=</span> <span class="n">waveform_generator</span><span class="o">.</span><span class="n">frequency_array</span>
        <span class="n">idx</span> <span class="o">=</span> <span class="p">(</span><span class="n">f_array</span> <span class="o">&gt;=</span> <span class="n">f_min</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">f_array</span> <span class="o">&lt;=</span> <span class="n">f_max</span><span class="p">)</span>
        <span class="n">h_plus</span> <span class="o">=</span> <span class="n">polas</span><span class="p">[</span><span class="s2">&quot;plus&quot;</span><span class="p">][</span><span class="n">idx</span><span class="p">]</span>
        <span class="n">h_cross</span> <span class="o">=</span> <span class="n">polas</span><span class="p">[</span><span class="s2">&quot;cross&quot;</span><span class="p">][</span><span class="n">idx</span><span class="p">]</span>

        <span class="n">SNRs_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">NetSNR</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="c1"># detectors = self.list_of_detectors</span>
        <span class="n">list_of_detectors</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="mi">21</span><span class="p">:]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
        <span class="n">psds_arrays</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="mi">20</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">list_of_detectors</span><span class="p">)):</span>
            <span class="c1"># need to compute the inner product for</span>
            <span class="n">p_array</span> <span class="o">=</span> <span class="n">psds_arrays</span><span class="p">[</span>
                <span class="n">list_of_detectors</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="p">]</span><span class="o">.</span><span class="n">get_power_spectral_density_array</span><span class="p">(</span><span class="n">f_array</span><span class="p">)[</span><span class="n">idx</span><span class="p">]</span>
            <span class="n">idx2</span> <span class="o">=</span> <span class="p">(</span><span class="n">p_array</span> <span class="o">!=</span> <span class="mf">0.0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">p_array</span> <span class="o">!=</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">)</span>
            <span class="n">hp_inner_hp</span> <span class="o">=</span> <span class="n">bilby</span><span class="o">.</span><span class="n">gw</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">noise_weighted_inner_product</span><span class="p">(</span>
                <span class="n">h_plus</span><span class="p">[</span><span class="n">idx2</span><span class="p">],</span> <span class="n">h_plus</span><span class="p">[</span><span class="n">idx2</span><span class="p">],</span> <span class="n">p_array</span><span class="p">[</span><span class="n">idx2</span><span class="p">],</span> <span class="n">waveform_generator</span><span class="o">.</span><span class="n">duration</span>
            <span class="p">)</span>
            <span class="n">hc_inner_hc</span> <span class="o">=</span> <span class="n">bilby</span><span class="o">.</span><span class="n">gw</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">noise_weighted_inner_product</span><span class="p">(</span>
                <span class="n">h_cross</span><span class="p">[</span><span class="n">idx2</span><span class="p">],</span> <span class="n">h_cross</span><span class="p">[</span><span class="n">idx2</span><span class="p">],</span> <span class="n">p_array</span><span class="p">[</span><span class="n">idx2</span><span class="p">],</span> <span class="n">waveform_generator</span><span class="o">.</span><span class="n">duration</span>
            <span class="p">)</span>
            <span class="c1"># make an ifo object to get the antenna pattern</span>
            <span class="n">Fp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ifos</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">antenna_response</span><span class="p">(</span>
                <span class="n">parameters</span><span class="p">[</span><span class="s2">&quot;ra&quot;</span><span class="p">],</span>
                <span class="n">parameters</span><span class="p">[</span><span class="s2">&quot;dec&quot;</span><span class="p">],</span>
                <span class="n">parameters</span><span class="p">[</span><span class="s2">&quot;geocent_time&quot;</span><span class="p">],</span>
                <span class="n">parameters</span><span class="p">[</span><span class="s2">&quot;psi&quot;</span><span class="p">],</span>
                <span class="s2">&quot;plus&quot;</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">Fc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ifos</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">antenna_response</span><span class="p">(</span>
                <span class="n">parameters</span><span class="p">[</span><span class="s2">&quot;ra&quot;</span><span class="p">],</span>
                <span class="n">parameters</span><span class="p">[</span><span class="s2">&quot;dec&quot;</span><span class="p">],</span>
                <span class="n">parameters</span><span class="p">[</span><span class="s2">&quot;geocent_time&quot;</span><span class="p">],</span>
                <span class="n">parameters</span><span class="p">[</span><span class="s2">&quot;psi&quot;</span><span class="p">],</span>
                <span class="s2">&quot;cross&quot;</span><span class="p">,</span>
            <span class="p">)</span>

            <span class="n">snrs_sq</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">((</span><span class="n">Fp</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">hp_inner_hp</span> <span class="o">+</span> <span class="p">(</span><span class="n">Fc</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">hc_inner_hc</span><span class="p">)</span>

            <span class="n">SNRs_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">snrs_sq</span><span class="p">))</span>
            <span class="n">NetSNR</span> <span class="o">+=</span> <span class="n">snrs_sq</span>

        <span class="n">SNRs_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">NetSNR</span><span class="p">))</span>

        <span class="k">return</span> <span class="p">(</span><span class="n">SNRs_list</span><span class="p">,</span> <span class="n">params</span><span class="p">[</span><span class="mi">19</span><span class="p">])</span>

    <span class="c1">####################################################</span>
    <span class="c1">#                                                  #</span>
    <span class="c1">#  Noise weigthed inner product (Multiprocessing)  #</span>
    <span class="c1">#                                                  #</span>
    <span class="c1">####################################################</span>
    <span class="k">def</span> <span class="nf">noise_weighted_inner_prod</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">params</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Probaility of detection of GW for the given sensitivity of the detectors</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        params : list</span>
<span class="sd">            list of parameters for the inner product calculation</span>
<span class="sd">            List contains: \n</span>
<span class="sd">            params[0] : float</span>
<span class="sd">                mass_1</span>
<span class="sd">            params[1] : float</span>
<span class="sd">                mass_2</span>
<span class="sd">            params[2] : float</span>
<span class="sd">                luminosity_distance</span>
<span class="sd">            params[3] : float</span>
<span class="sd">                theta_jn</span>
<span class="sd">            params[4] : float</span>
<span class="sd">                psi</span>
<span class="sd">            params[5] : float</span>
<span class="sd">                phase</span>
<span class="sd">            params[6] : float</span>
<span class="sd">                ra</span>
<span class="sd">            params[7] : float</span>
<span class="sd">                dec</span>
<span class="sd">            params[8] : float</span>
<span class="sd">                geocent_time</span>
<span class="sd">            params[9] : float</span>
<span class="sd">                a_1</span>
<span class="sd">            params[10] : float</span>
<span class="sd">                a_2</span>
<span class="sd">            params[11] : float</span>
<span class="sd">                tilt_1</span>
<span class="sd">            params[12] : float</span>
<span class="sd">                tilt_2</span>
<span class="sd">            params[13] : float</span>
<span class="sd">                phi_12</span>
<span class="sd">            params[14] : float</span>
<span class="sd">                phi_jl</span>
<span class="sd">            params[15] : float</span>
<span class="sd">                approximant</span>
<span class="sd">            params[16] : float</span>
<span class="sd">                f_min</span>
<span class="sd">            params[17] : float</span>
<span class="sd">                duration</span>
<span class="sd">            params[18] : float</span>
<span class="sd">                sampling_frequency</span>
<span class="sd">            params[19] : int</span>
<span class="sd">                index tracker</span>
<span class="sd">            psds_list[20] : list</span>
<span class="sd">                list of psds for each detector</span>
<span class="sd">            detector_list[21:] : list</span>
<span class="sd">                list of detectors</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        SNRs_list : list</span>
<span class="sd">            contains opt_snr for each detector and net_opt_snr</span>
<span class="sd">        params[19] : int</span>
<span class="sd">            index tracker</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">bilby</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">disabled</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">88170235</span><span class="p">)</span>
        <span class="n">parameters</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;mass_1&quot;</span><span class="p">:</span> <span class="n">params</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
            <span class="s2">&quot;mass_2&quot;</span><span class="p">:</span> <span class="n">params</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
            <span class="s2">&quot;luminosity_distance&quot;</span><span class="p">:</span> <span class="n">params</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span>
            <span class="s2">&quot;theta_jn&quot;</span><span class="p">:</span> <span class="n">params</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span>
            <span class="s2">&quot;psi&quot;</span><span class="p">:</span> <span class="n">params</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span>
            <span class="s2">&quot;phase&quot;</span><span class="p">:</span> <span class="n">params</span><span class="p">[</span><span class="mi">5</span><span class="p">],</span>
            <span class="s2">&quot;geocent_time&quot;</span><span class="p">:</span> <span class="n">params</span><span class="p">[</span><span class="mi">8</span><span class="p">],</span>
            <span class="s2">&quot;ra&quot;</span><span class="p">:</span> <span class="n">params</span><span class="p">[</span><span class="mi">6</span><span class="p">],</span>
            <span class="s2">&quot;dec&quot;</span><span class="p">:</span> <span class="n">params</span><span class="p">[</span><span class="mi">7</span><span class="p">],</span>
            <span class="s2">&quot;a_1&quot;</span><span class="p">:</span> <span class="n">params</span><span class="p">[</span><span class="mi">9</span><span class="p">],</span>
            <span class="s2">&quot;a_2&quot;</span><span class="p">:</span> <span class="n">params</span><span class="p">[</span><span class="mi">10</span><span class="p">],</span>
            <span class="s2">&quot;tilt_1&quot;</span><span class="p">:</span> <span class="n">params</span><span class="p">[</span><span class="mi">11</span><span class="p">],</span>
            <span class="s2">&quot;tilt_2&quot;</span><span class="p">:</span> <span class="n">params</span><span class="p">[</span><span class="mi">12</span><span class="p">],</span>
            <span class="s2">&quot;phi_12&quot;</span><span class="p">:</span> <span class="n">params</span><span class="p">[</span><span class="mi">13</span><span class="p">],</span>
            <span class="s2">&quot;phi_jl&quot;</span><span class="p">:</span> <span class="n">params</span><span class="p">[</span><span class="mi">14</span><span class="p">],</span>
        <span class="p">}</span>

        <span class="n">waveform_arguments</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
            <span class="n">waveform_approximant</span><span class="o">=</span><span class="n">params</span><span class="p">[</span><span class="mi">15</span><span class="p">],</span>
            <span class="n">reference_frequency</span><span class="o">=</span><span class="mf">20.0</span><span class="p">,</span>
            <span class="n">minimum_frequency</span><span class="o">=</span><span class="n">params</span><span class="p">[</span><span class="mi">16</span><span class="p">],</span>
        <span class="p">)</span>

        <span class="n">waveform_generator</span> <span class="o">=</span> <span class="n">bilby</span><span class="o">.</span><span class="n">gw</span><span class="o">.</span><span class="n">WaveformGenerator</span><span class="p">(</span>
            <span class="n">duration</span><span class="o">=</span><span class="n">params</span><span class="p">[</span><span class="mi">17</span><span class="p">],</span>
            <span class="n">sampling_frequency</span><span class="o">=</span><span class="n">params</span><span class="p">[</span><span class="mi">18</span><span class="p">],</span>
            <span class="n">frequency_domain_source_model</span><span class="o">=</span><span class="n">bilby</span><span class="o">.</span><span class="n">gw</span><span class="o">.</span><span class="n">source</span><span class="o">.</span><span class="n">lal_binary_black_hole</span><span class="p">,</span>
            <span class="n">waveform_arguments</span><span class="o">=</span><span class="n">waveform_arguments</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">polas</span> <span class="o">=</span> <span class="n">waveform_generator</span><span class="o">.</span><span class="n">frequency_domain_strain</span><span class="p">(</span><span class="n">parameters</span><span class="o">=</span><span class="n">parameters</span><span class="p">)</span>

        <span class="c1"># h = F+.h+ + Fx.hx</span>
        <span class="c1"># &lt;h|h&gt;</span>
        <span class="c1"># </span>

        <span class="n">SNRs_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">NetSNR</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="n">list_of_detectors</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="mi">21</span><span class="p">:]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
        <span class="n">psds_arrays</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="mi">20</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">list_of_detectors</span><span class="p">)):</span>
            <span class="c1"># need to compute the inner product for</span>
            <span class="n">p_array</span> <span class="o">=</span> <span class="n">psds_arrays</span><span class="p">[</span>
                <span class="n">list_of_detectors</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="p">]</span><span class="o">.</span><span class="n">get_power_spectral_density_array</span><span class="p">(</span><span class="n">waveform_generator</span><span class="o">.</span><span class="n">frequency_array</span><span class="p">)</span>
            <span class="n">idx2</span> <span class="o">=</span> <span class="p">(</span><span class="n">p_array</span> <span class="o">!=</span> <span class="mf">0.0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">p_array</span> <span class="o">!=</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">)</span>
            <span class="n">hp_inner_hp</span> <span class="o">=</span> <span class="n">bilby</span><span class="o">.</span><span class="n">gw</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">noise_weighted_inner_product</span><span class="p">(</span>
                <span class="n">polas</span><span class="p">[</span><span class="s2">&quot;plus&quot;</span><span class="p">][</span><span class="n">idx2</span><span class="p">],</span>
                <span class="n">polas</span><span class="p">[</span><span class="s2">&quot;plus&quot;</span><span class="p">][</span><span class="n">idx2</span><span class="p">],</span>
                <span class="n">p_array</span><span class="p">[</span><span class="n">idx2</span><span class="p">],</span>
                <span class="n">waveform_generator</span><span class="o">.</span><span class="n">duration</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">hc_inner_hc</span> <span class="o">=</span> <span class="n">bilby</span><span class="o">.</span><span class="n">gw</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">noise_weighted_inner_product</span><span class="p">(</span>
                <span class="n">polas</span><span class="p">[</span><span class="s2">&quot;cross&quot;</span><span class="p">][</span><span class="n">idx2</span><span class="p">],</span>
                <span class="n">polas</span><span class="p">[</span><span class="s2">&quot;cross&quot;</span><span class="p">][</span><span class="n">idx2</span><span class="p">],</span>
                <span class="n">p_array</span><span class="p">[</span><span class="n">idx2</span><span class="p">],</span>
                <span class="n">waveform_generator</span><span class="o">.</span><span class="n">duration</span><span class="p">,</span>
            <span class="p">)</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            hp_inner_hc = bilby.gw.utils.noise_weighted_inner_product(</span>
<span class="sd">                polas[&quot;plus&quot;][idx2],</span>
<span class="sd">                polas[&quot;cross&quot;][idx2],</span>
<span class="sd">                p_array[idx2],</span>
<span class="sd">                waveform_generator.duration,</span>
<span class="sd">            )</span>
<span class="sd">            &quot;&quot;&quot;</span>
            <span class="c1"># make an ifo object to get the antenna pattern</span>
            <span class="n">Fp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ifos</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">antenna_response</span><span class="p">(</span>
                <span class="n">parameters</span><span class="p">[</span><span class="s2">&quot;ra&quot;</span><span class="p">],</span>
                <span class="n">parameters</span><span class="p">[</span><span class="s2">&quot;dec&quot;</span><span class="p">],</span>
                <span class="n">parameters</span><span class="p">[</span><span class="s2">&quot;geocent_time&quot;</span><span class="p">],</span>
                <span class="n">parameters</span><span class="p">[</span><span class="s2">&quot;psi&quot;</span><span class="p">],</span>
                <span class="s2">&quot;plus&quot;</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">Fc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ifos</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">antenna_response</span><span class="p">(</span>
                <span class="n">parameters</span><span class="p">[</span><span class="s2">&quot;ra&quot;</span><span class="p">],</span>
                <span class="n">parameters</span><span class="p">[</span><span class="s2">&quot;dec&quot;</span><span class="p">],</span>
                <span class="n">parameters</span><span class="p">[</span><span class="s2">&quot;geocent_time&quot;</span><span class="p">],</span>
                <span class="n">parameters</span><span class="p">[</span><span class="s2">&quot;psi&quot;</span><span class="p">],</span>
                <span class="s2">&quot;cross&quot;</span><span class="p">,</span>
            <span class="p">)</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            snrs_sq = abs(</span>
<span class="sd">                (Fp**2) * hp_inner_hp</span>
<span class="sd">                + (Fc**2) * hc_inner_hc</span>
<span class="sd">                + 2 * Fp * Fc * hp_inner_hc</span>
<span class="sd">            )</span>
<span class="sd">            &quot;&quot;&quot;</span>
            <span class="n">snrs_sq</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">((</span><span class="n">Fp</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">hp_inner_hp</span> <span class="o">+</span> <span class="p">(</span><span class="n">Fc</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">hc_inner_hc</span><span class="p">)</span>

            <span class="n">SNRs_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">snrs_sq</span><span class="p">))</span>
            <span class="n">NetSNR</span> <span class="o">+=</span> <span class="n">snrs_sq</span>

        <span class="n">SNRs_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">NetSNR</span><span class="p">))</span>

        <span class="k">return</span> <span class="p">(</span><span class="n">SNRs_list</span><span class="p">,</span> <span class="n">params</span><span class="p">[</span><span class="mi">19</span><span class="p">])</span>

    <span class="c1">####################################################</span>
    <span class="c1">#                                                  #</span>
    <span class="c1">#             Probaility of detection              #</span>
    <span class="c1">#                                                  #</span>
    <span class="c1">####################################################</span>
    <span class="k">def</span> <span class="nf">pdet</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">snrs</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">rho_th</span><span class="o">=</span><span class="mf">8.0</span><span class="p">,</span> <span class="n">rhoNet_th</span><span class="o">=</span><span class="mf">8.0</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Probaility of detection of GW for the given sensitivity of the detectors</span>
<span class="sd">        -----------------</span>
<span class="sd">        Input parameters</span>
<span class="sd">        -----------------</span>
<span class="sd">        snrs      : Signal-to-noise ratio for all the chosen detectors and GW parameters</span>
<span class="sd">                    (numpy array of float)</span>

<span class="sd">        -----------------</span>
<span class="sd">        Return values</span>
<span class="sd">        -----------------</span>
<span class="sd">        dict_pdet  : dictionary of {&#39;pdet_net&#39;:pdet_net, &#39;pdet_L1&#39;:pdet_L1, &#39;pdet_H1&#39;:pdet_H1, &#39;pdet_V1&#39;:pdet_V1}</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">snrs</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
            <span class="n">snrs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stored_snrs</span>

        <span class="n">detectors</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">list_of_detectors</span>
        <span class="n">pdet_dict</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">det</span> <span class="ow">in</span> <span class="n">detectors</span><span class="p">:</span>
            <span class="n">pdet_dict</span><span class="p">[</span><span class="s2">&quot;pdet_&quot;</span> <span class="o">+</span> <span class="n">det</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">norm</span><span class="o">.</span><span class="n">cdf</span><span class="p">(</span><span class="n">rho_th</span> <span class="o">-</span> <span class="n">snrs</span><span class="p">[</span><span class="n">det</span><span class="p">])</span>

        <span class="n">pdet_dict</span><span class="p">[</span><span class="s2">&quot;pdet_net&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">norm</span><span class="o">.</span><span class="n">cdf</span><span class="p">(</span><span class="n">rhoNet_th</span> <span class="o">-</span> <span class="n">snrs</span><span class="p">[</span><span class="s2">&quot;opt_snr_net&quot;</span><span class="p">])</span>

        <span class="k">return</span> <span class="n">pdet_dict</span>

    <span class="c1">####################################################</span>
    <span class="c1">#                                                  #</span>
    <span class="c1">#                   Chirp time                     #</span>
    <span class="c1">#                                                  #</span>
    <span class="c1">####################################################</span>
    <span class="k">def</span> <span class="nf">findchirp_chirptime</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">m1</span><span class="p">,</span> <span class="n">m2</span><span class="p">,</span> <span class="n">fmin</span><span class="o">=</span><span class="mf">20.0</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Time taken from f_min to f_lso (last stable orbit). 3.5PN in fourier phase considered.</span>
<span class="sd">        -----------------</span>
<span class="sd">        Input parameters</span>
<span class="sd">        -----------------</span>
<span class="sd">        m1         : component mass of BBH, m1&gt;m2, unit(Mo)</span>
<span class="sd">        m2         : component mass of BBH, m1&gt;m2, unit(Mo)</span>
<span class="sd">        fmin       : minimum frequency cut-off for the analysis, unit(s)</span>
<span class="sd">        -----------------</span>
<span class="sd">        Return values</span>
<span class="sd">        -----------------</span>
<span class="sd">        chirp_time : Time taken from f_min to f_lso (frequency at last stable orbit), unit(s)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># variables used to compute chirp time</span>
        <span class="n">m</span> <span class="o">=</span> <span class="n">m1</span> <span class="o">+</span> <span class="n">m2</span>
        <span class="n">eta</span> <span class="o">=</span> <span class="n">m1</span> <span class="o">*</span> <span class="n">m2</span> <span class="o">/</span> <span class="n">m</span> <span class="o">/</span> <span class="n">m</span>
        <span class="n">c0T</span> <span class="o">=</span> <span class="n">c2T</span> <span class="o">=</span> <span class="n">c3T</span> <span class="o">=</span> <span class="n">c4T</span> <span class="o">=</span> <span class="n">c5T</span> <span class="o">=</span> <span class="n">c6T</span> <span class="o">=</span> <span class="n">c6LogT</span> <span class="o">=</span> <span class="n">c7T</span> <span class="o">=</span> <span class="mf">0.0</span>

        <span class="n">c7T</span> <span class="o">=</span> <span class="n">Pi</span> <span class="o">*</span> <span class="p">(</span>
            <span class="mf">14809.0</span> <span class="o">*</span> <span class="n">eta</span> <span class="o">*</span> <span class="n">eta</span> <span class="o">/</span> <span class="mf">378.0</span> <span class="o">-</span> <span class="mf">75703.0</span> <span class="o">*</span> <span class="n">eta</span> <span class="o">/</span> <span class="mf">756.0</span> <span class="o">-</span> <span class="mf">15419335.0</span> <span class="o">/</span> <span class="mf">127008.0</span>
        <span class="p">)</span>

        <span class="n">c6T</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">Gamma</span> <span class="o">*</span> <span class="mf">6848.0</span> <span class="o">/</span> <span class="mf">105.0</span>
            <span class="o">-</span> <span class="mf">10052469856691.0</span> <span class="o">/</span> <span class="mf">23471078400.0</span>
            <span class="o">+</span> <span class="n">Pi</span> <span class="o">*</span> <span class="n">Pi</span> <span class="o">*</span> <span class="mf">128.0</span> <span class="o">/</span> <span class="mf">3.0</span>
            <span class="o">+</span> <span class="n">eta</span> <span class="o">*</span> <span class="p">(</span><span class="mf">3147553127.0</span> <span class="o">/</span> <span class="mf">3048192.0</span> <span class="o">-</span> <span class="n">Pi</span> <span class="o">*</span> <span class="n">Pi</span> <span class="o">*</span> <span class="mf">451.0</span> <span class="o">/</span> <span class="mf">12.0</span><span class="p">)</span>
            <span class="o">-</span> <span class="n">eta</span> <span class="o">*</span> <span class="n">eta</span> <span class="o">*</span> <span class="mf">15211.0</span> <span class="o">/</span> <span class="mf">1728.0</span>
            <span class="o">+</span> <span class="n">eta</span> <span class="o">*</span> <span class="n">eta</span> <span class="o">*</span> <span class="n">eta</span> <span class="o">*</span> <span class="mf">25565.0</span> <span class="o">/</span> <span class="mf">1296.0</span>
            <span class="o">+</span> <span class="n">eta</span> <span class="o">*</span> <span class="n">eta</span> <span class="o">*</span> <span class="n">eta</span> <span class="o">*</span> <span class="mf">25565.0</span> <span class="o">/</span> <span class="mf">1296.0</span>
            <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mf">4.0</span><span class="p">)</span> <span class="o">*</span> <span class="mf">6848.0</span> <span class="o">/</span> <span class="mf">105.0</span>
        <span class="p">)</span>
        <span class="n">c6LogT</span> <span class="o">=</span> <span class="mf">6848.0</span> <span class="o">/</span> <span class="mf">105.0</span>

        <span class="n">c5T</span> <span class="o">=</span> <span class="mf">13.0</span> <span class="o">*</span> <span class="n">Pi</span> <span class="o">*</span> <span class="n">eta</span> <span class="o">/</span> <span class="mf">3.0</span> <span class="o">-</span> <span class="mf">7729.0</span> <span class="o">*</span> <span class="n">Pi</span> <span class="o">/</span> <span class="mf">252.0</span>

        <span class="n">c4T</span> <span class="o">=</span> <span class="mf">3058673.0</span> <span class="o">/</span> <span class="mf">508032.0</span> <span class="o">+</span> <span class="n">eta</span> <span class="o">*</span> <span class="p">(</span><span class="mf">5429.0</span> <span class="o">/</span> <span class="mf">504.0</span> <span class="o">+</span> <span class="n">eta</span> <span class="o">*</span> <span class="mf">617.0</span> <span class="o">/</span> <span class="mf">72.0</span><span class="p">)</span>
        <span class="n">c3T</span> <span class="o">=</span> <span class="o">-</span><span class="mf">32.0</span> <span class="o">*</span> <span class="n">Pi</span> <span class="o">/</span> <span class="mf">5.0</span>
        <span class="n">c2T</span> <span class="o">=</span> <span class="mf">743.0</span> <span class="o">/</span> <span class="mf">252.0</span> <span class="o">+</span> <span class="n">eta</span> <span class="o">*</span> <span class="mf">11.0</span> <span class="o">/</span> <span class="mf">3.0</span>
        <span class="n">c0T</span> <span class="o">=</span> <span class="mf">5.0</span> <span class="o">*</span> <span class="n">m</span> <span class="o">*</span> <span class="n">MTSUN_SI</span> <span class="o">/</span> <span class="p">(</span><span class="mf">256.0</span> <span class="o">*</span> <span class="n">eta</span><span class="p">)</span>

        <span class="c1"># This is the PN parameter v evaluated at the lower freq. cutoff</span>
        <span class="n">xT</span> <span class="o">=</span> <span class="nb">pow</span><span class="p">(</span><span class="n">Pi</span> <span class="o">*</span> <span class="n">m</span> <span class="o">*</span> <span class="n">MTSUN_SI</span> <span class="o">*</span> <span class="n">fmin</span><span class="p">,</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="mf">3.0</span><span class="p">)</span>
        <span class="n">x2T</span> <span class="o">=</span> <span class="n">xT</span> <span class="o">*</span> <span class="n">xT</span>
        <span class="n">x3T</span> <span class="o">=</span> <span class="n">xT</span> <span class="o">*</span> <span class="n">x2T</span>
        <span class="n">x4T</span> <span class="o">=</span> <span class="n">x2T</span> <span class="o">*</span> <span class="n">x2T</span>
        <span class="n">x5T</span> <span class="o">=</span> <span class="n">x2T</span> <span class="o">*</span> <span class="n">x3T</span>
        <span class="n">x6T</span> <span class="o">=</span> <span class="n">x3T</span> <span class="o">*</span> <span class="n">x3T</span>
        <span class="n">x7T</span> <span class="o">=</span> <span class="n">x3T</span> <span class="o">*</span> <span class="n">x4T</span>
        <span class="n">x8T</span> <span class="o">=</span> <span class="n">x4T</span> <span class="o">*</span> <span class="n">x4T</span>

        <span class="c1"># Computes the chirp time as tC = t(v_low)</span>
        <span class="c1"># tC = t(v_low) - t(v_upper) would be more</span>
        <span class="c1"># correct, but the difference is negligble.</span>
        <span class="k">return</span> <span class="p">(</span>
            <span class="n">c0T</span>
            <span class="o">*</span> <span class="p">(</span>
                <span class="mi">1</span>
                <span class="o">+</span> <span class="n">c2T</span> <span class="o">*</span> <span class="n">x2T</span>
                <span class="o">+</span> <span class="n">c3T</span> <span class="o">*</span> <span class="n">x3T</span>
                <span class="o">+</span> <span class="n">c4T</span> <span class="o">*</span> <span class="n">x4T</span>
                <span class="o">+</span> <span class="n">c5T</span> <span class="o">*</span> <span class="n">x5T</span>
                <span class="o">+</span> <span class="p">(</span><span class="n">c6T</span> <span class="o">+</span> <span class="n">c6LogT</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">xT</span><span class="p">))</span> <span class="o">*</span> <span class="n">x6T</span>
                <span class="o">+</span> <span class="n">c7T</span> <span class="o">*</span> <span class="n">x7T</span>
            <span class="p">)</span>
            <span class="o">/</span> <span class="n">x8T</span>
        <span class="p">)</span>


<span class="c1"># Store as JSON a numpy.ndarray or any nested-list composition.</span>
<div class="viewcode-block" id="NumpyEncoder">
<a class="viewcode-back" href="../autoapi/gwsnrcheckpoint/index.html#gwsnr-checkpoint.NumpyEncoder">[docs]</a>
<span class="k">class</span> <span class="nc">NumpyEncoder</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">JSONEncoder</span><span class="p">):</span>
<div class="viewcode-block" id="NumpyEncoder.default">
<a class="viewcode-back" href="../autoapi/gwsnrcheckpoint/index.html#gwsnr-checkpoint.NumpyEncoder.default">[docs]</a>
    <span class="k">def</span> <span class="nf">default</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">obj</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">json</span><span class="o">.</span><span class="n">JSONEncoder</span><span class="o">.</span><span class="n">default</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">)</span></div>
</div>

</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2023, Phurailatpam Hemantakumar.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>